<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
<style type="text/css">
A.black:link {COLOR: #000000; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
A.black:visited {COLOR: #000000; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
A.black:hover {COLOR: #FFFFFF; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
.b {text-decoration: none; color:#FF0000;} 
.b:hover {color:#7785FF;}
.c {text-decoration: none; color:#000000;} 
.c:hover {color:#FFFFFF;}
 pre {color: blue;}
TD.colon {COLOR: #000000; FONT-FAMILY: "MS Sans Serif", sans-serif; FONT-SIZE: 9pt}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta content="программирование на Visual Basic, документация, документы, delphi, pascal, cpp, hardware, web, веб-мастер, советы, описания, доки, manual, Java, C, C++, обучение, исходники, odbc, jdbc, programm, protocols, протоколы, общение, форумapplet, java, design, апплет, дизайн, ява, Free, counters, Trackers, Guestbooks, Access Logs, Banners, Graphics, Banner ads, Fonts, Form Mailer, form mailers, graphics, icons, games, freeware, shareware, forms, guestbooks, Java, Javascript, contests, puzzles, fonts, font resources, E-mail programs, reminder services, product samples, samples, Email services, E-mail services, advertising, graphics, free banner ads, free World Wide Web resources, counters, Trackers, Guestbooks, Access Logs, Banners, Graphics, Banner ads, Fonts, Form Mailer, form mailers, graphics, icons, games, freeware, shareware, forms, guestbooks, Java, Javascript, contests, puzzles, fonts, font resources, E-mail programs, reminder services, product samples, samples, Email services, E-mail services, advertising, graphics, free banner ads, free World Wide Web resources" name="keywords">
<meta NAME="RESOURCE-TYPE"
CONTENT="pop hypertext sources hypermedia server scripting shtml phtml html developer code base tools open source web site browser free software webmaster cgi dhtml dynamic content netscape explorer shareware download website construction free tutorial news design maintenance page hit cvs mailing list projects httpd mod_perl mod www htdig xml perl scripts script server-side-include apache database MySQL mysql msql postres postresql module linux online cpp Visual Basic JavaScript delphi wap job informer java opengl directx">
<title>Информационный сервер для программистов - исходники со всего света.</title>
</head>

<body topmargin="0" leftmargin="0" marginwidth="0" marginheigth="0" bgcolor=white>

<form action="/cgi-bin/sources/search/search.pl" method="get" align="left">
  <input type="hidden" name="stpos" value="0"><table border="0" cellpadding="0"
  cellspacing="0" width="750">
    <tr>
      <td valign="top" rowspan="2"><table border="0" cellpadding="0" cellspacing="0" width="287">
        <tr>
          <td colspan="2" bgcolor="#A5E4A7" valign="middle" align="center"><b>WWW.ИСХОДНИКИ.РУ</b></td>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">cpp.sources.ru</font></b></td>
        </tr>
        <tr>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">java.sources.ru</font></b></td>
          <td bgcolor="#C0C0C0" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>web.sources.ru</b></font></td>
          <td bgcolor="#A5E4A7" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>soft.sources.ru</b></font></td>
        </tr>
        <tr>
          <td bgcolor="#C0C0C0" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>jdbc.sources.ru</b></font></td>
          <td bgcolor="#A5E4A7" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>asp.sources.ru</b></font></td>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">api.sources.ru</font></b></td>
        </tr>
      </table>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td><font style="font-size: 8pt" size="2" face="Tahoma">&nbsp; Поиск по
          программированию :<br>
          </font>&nbsp; <input type="text" size="13" name="query"> <input type="submit"
          value="Поиск"><font size="1"><input
          TYPE="Radio" NAME="stype" VALUE="AND" checked>&quot;AND&quot; <input TYPE="Radio"
          NAME="stype" VALUE="OR">&quot;OR&quot;</font>


<!--TopList COUNTER--><a target=_top
href="http://top.list.ru/jump?from=89876"><script language="JavaScript"><!--
d=document;a='';a+=';r='+escape(d.referrer)
js=10//--></script><script language="JavaScript1.1"><!--
a+=';j='+navigator.javaEnabled()
js=11//--></script><script language="JavaScript1.2"><!--
s=screen;a+=';s='+s.width+'*'+s.height
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth)
js=12//--></script><script language="JavaScript1.3"><!--
js=13//--></script><script language="JavaScript"><!--
d.write('<img src="http://top.list.ru/counter'+
'?id=89876;t=57;js='+js+a+';rand='+Math.random()+
'" alt="TopList" '+ 'border=0 height=1 width=1>')
if(js>11)d.write('<'+'!-- ')//--></script><noscript><img
src="http://top.list.ru/counter?js=na;id=89876;t=57"
border=0 height=1 width=1
alt="TopList"></noscript><script language="JavaScript"><!--
if(js>11)d.write('--'+'>')//--></script></a><!--TopList COUNTER-->


<a href="http://counter.rambler.ru/top100/"><img src="http://counter.rambler.ru/top100.cnt?163871" alt="Rambler's Top100" width=1 height=1 border=0></a>

<!-- SpyLOG f:0211 --> 
<script language="javascript"> 
u="u1624.10.spylog.com";d=document;nv=navigator;na=nv.appName;p=1; 
bv=Math.round(parseFloat(nv.appVersion)*100); 
n=(na.substring(0,2)=="Mi")?0:1;rn=Math.random();z="p="+p+"&rn="+rn;y=""; 
y+="<a href='http://"+u+"/cnt?f=3&p="+p+"&rn="+rn+"' target=_blank>"; 
y+="<img src='http://"+u+"/cnt?"+z+ "&r="+escape(d.referrer)+"&pg="+escape(window.location.href)+"' border=0 width=1 height=1 alt='SpyLOG'>"; 
y+="</a>"; d.write(y);if(!n) { d.write("<"+"!--"); }//--></script><noscript> 
<a href="http://u1624.10.spylog.com/cnt?f=3&p=1" target=_blank> 
<img src="http://u1624.10.spylog.com/cnt?p=1" alt='SpyLOG' border='0' width=1 height=1 > 
</a></noscript><script language="javascript1.2"><!-- 
if(!n) { d.write("--"+">"); }//--></script> 
<!-- SpyLOG -->


</td>
        </tr>
      </table>
      </td>
      <td align="center"><font style="font-size: 15pt" color="#4904B1" size="4"
      face="Times New Roman">Информационный сервер</font></td>
    </tr>
    <tr>
      <td>


<!-- LBE -->
<script>
// <!--
rand = Math.round((Math.random() * (10000 - 1)));
document.write("<a href=http://www.lbe.ru/cgi-bin/href/castle?" + rand + " target=_blank><img src=http://www.lbe.ru/cgi-bin/banner/castle?" + rand + " width=468 height=60 border=0 alt=LBE ismap></a><br>");
// -->
</script>
<noscript>
                                                                                                                                                                <br>
</noscript>
<!-- LBE -->



      </td>
    </tr>
    <tr>
      <td colspan="2"><table border="0" cellpadding="0" cellspacing="1" width="100%">
        <tr>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a
          href="../www.sources.html"><font color="#000000" size="2">На главную</font></a></td>
          <td align="center" width="20%" bgcolor="#E0E0C6"><a
          href="../subscribe.html"><font color="#000000" size="2">Подписаться на новости</font></a></td>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a href="../cgi-bin/sources/Ultimate.pl"><font color="#000000" size="2">Форум</font></a></td>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a href="../books.html"><font color="#000000" size="2">Книги</font></a></td>
          <td align="center" width="7%" bgcolor="#E0E0C6"><a href="http://chat.vidcenter.ru:82/"><font color="#000000" size="2">Чат</font></a></td>
          <td align="center" width="13%" bgcolor="#E0E0C6"><a href="http://www.countries.ru/"><font color="#000000" size="2">Страны мира</font></a></td>
          <td align="center" width="29%" bgcolor="#E0E0C6"><b>16</b> пользователей на сервере.
</td>
        </tr>
      </table>
      </td>
    </tr>
  </table>
</form>

<div align="center"><center>

<table width="680" cellspacing="0" cellpadding="0">
  <tr>
    <td><hr>
    <h3>Чтение файлов Excel через ODBC.</h3>
    <p>Автор: <a href="mailto:almikula@EUnet.at">Alexander Mikula</a><ul>
      <li><a href="excel_odbc_demo.zip">Скачать демонстрационный
        проект - 20 Kb</a><p>После публикации <a
        href="cpp_creating_excel_odbc.html">статьи</a> о том, как как
        создать Excel файл, многим очень захотелось узнать -
        а как же из такого файла можно считать данные. ОК,
        давайте разберёмся ... </p>
        <h2>Что нам потребуется</h2>
        <p>Чтобы приведённый ниже код заставить работать
        необходимо проделать следующее: </p>
      </li>
      <li>include &lt;afxdb.h&gt; </li>
      <li>include &lt;odbcinst.h&gt; </li>
      <li>инсталлировать ODBC-драйвер под названием
        &quot;MICROSOFT EXCEL DRIVER (*.XLS)&quot; (или что-то вроде этого) </li>
      <li>У Вас должен быть установлен Администратор (Admin)
        ODBC версии 3.5 или выше <h2>Недостатки</h2>
        <p>Использование псевдо DSN работает только с ODBC
        Администратором версии 3.51 и выше.</p>
        <p>Использование класса <code>CRecordset</code> напрямую
        (без наследования) позволяет только считывать.
        Любые попытки изменить данные в базе приведут к
        отказу в доступе. Если Вам всё-таки надо
        произвести такую операцию, то прийдётся
        использовать <code>CRecordset</code> обычным путём. Другой
        недостаток состоит в том, что большой по объёму <code>CRecordset</code>
        существенно замедляет производительность.
        Решение этого недостатка заключается в
        использовании класса <code>CSQLDirect</code> находящегося
        в http://www.codeguru.com/mfc_database/direct_sql_with_odbc.shtml. </p>
      </li>
    </ul>
    <h2>Исходный код</h2>
    <pre>// Запрос файла Excel
void CReadExcelDlg::OnButton1() 
{
    CDatabase database;
    CString sSql;
    CString sItem1, sItem2;
    CString sDriver;
    CString sDsn;
    CString sFile = &quot;ReadExcel.xls&quot;; // имя файла. также можно использовать
                                  // что-то вроде C:\\Sheets\\WhatDoIKnow.xls
    
    // Очищаем содержимое listbox
    m_ctrlList.ResetContent();
    
    // Ищем имя драйвера Excel. Это необходимо,
    // потому что Microsoft имеет особенность использовать
    // специфицеские имена типа &quot;Microsoft Excel Driver (*.xls)&quot; вместо
    // &quot;Microsoft Excel Treiber (*.xls)&quot;
    sDriver = GetExcelDriver();
    if (sDriver.IsEmpty())
    {
        // Не получается найти этот драйвер!
        AfxMessageBox(&quot;No Excel ODBC driver found&quot;);
        return;
    }
    
    // Создаём псевдо DSN, включая имя драйвера и файла Excel
    // теперь нам не понадобится иметь явный DSN, установленный в
    // нашего Администратора ODBC
    sDsn.Format(&quot;ODBC;DRIVER={%s};DSN='';DBQ=%s&quot;, sDriver, sFile);

    TRY
    {
        // Открываем базу данных, используя предварительно созданный
        // псевдо DSN
        database.Open(NULL, false, false, sDsn);
        
        // Распределяем записи
        CRecordset recset(&amp;database);

        // Конструируем строку SQL запроса
        // Заполните имена секций данных в Excel таблице, используя
        // &quot;Insert-&gt;Names&quot;(Вставка-&gt;Имя), чтобы можно было работать данными
        // как с таблицей в реальной базе данных. В Excel файле так же
        // может содержаться более одной таблицы.
        sSql = &quot;SELECT field_1, field_2 &quot;       
               &quot;FROM demo_table &quot;                 
               &quot;ORDER BY field_1&quot;;
    
        // Выполняем данный запрос (косвенно открывая recordset)
        recset.Open(CRecordset::forwardOnly, sSql, CRecordset::readOnly);

        // получаем результаты
        while (!recset.IsEOF())
        {
            // читаем строку результата
            recset.GetFieldValue(&quot;field_1&quot;, sItem1);
            recset.GetFieldValue(&quot;field_2&quot;, sItem2);

            // Вставляем результат в список
            m_ctrlList.AddString(sItem1 + &quot; --&gt; &quot;+sItem2);

            // Skip to the next resultline
            recset.MoveNext();
        }

        // Закрываем базу данных
        database.Close();
                             
    }
    CATCH(CDBException, e)
    {
        // Открытие базы данных вызвало исключение, проще говоря ошибку...
        AfxMessageBox(&quot;Database error: &quot; + e-&gt;m_strError);
    }
    END_CATCH;
}


// Получаем имя Excel-ODBC драйвера 
CString CReadExcelDlg::GetExcelDriver()
{
    char szBuf[2001];
    WORD cbBufMax = 2000;
    WORD cbBufOut;
    char *pszBuf = szBuf;
    CString sDriver;

    // Получаем имена проинсталлированных драйверов
    // (&quot;odbcinst.h&quot; должен быть включён в проект )
    if (!SQLGetInstalledDrivers(szBuf, cbBufMax, &amp;cbBufOut))
        return &quot;&quot;;
    
    // Ищем драйвер...
    do
    {
        if (strstr(pszBuf, &quot;Excel&quot;) != 0)
        {
            // Нашли !
            sDriver = CString(pszBuf);
            break;
        }
        pszBuf = strchr(pszBuf, '\0') + 1;
    }
    while (pszBuf[1] != '\0');

    return sDriver;
}
</pre>
    <p>Подробности смотрите в демо-проекте (ReadExcelDlg.cpp)</p>
    <pre>
</pre>
    </td>
  </tr>
</table>
</center></div></TBODY>


<p align="center"><br>
<br>
</p>


<hr>
<div align="center"><center>

<table border="0" cellpadding="0" cellspacing="3" width="468">
  <tr>
    <td width="154"><!-- LBE_LITE --> <script>
// <!--
rand = Math.round((Math.random() * (10000 - 1)));
document.write("<a href=http://lite.lbe.ru/cgi-bin/href/castle?" + rand + " target=_blank><img src=http://lite.lbe.ru/cgi-bin/banner/castle?" + rand + " width=468 height=60 border=0 alt=LBE_LITE ismap></a><br>");
// -->
</script> <noscript> <br>
</noscript><!-- LBE_LITE --></td>
  </tr>
</table>
</center></div>
</body>
</html>
