<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
<style type="text/css">
A.black:link {COLOR: #000000; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
A.black:visited {COLOR: #000000; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
A.black:hover {COLOR: #FFFFFF; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
.b {text-decoration: none; color:#FF0000;} 
.b:hover {color:#7785FF;}
.c {text-decoration: none; color:#000000;} 
.c:hover {color:#FFFFFF;}
 pre {color: blue;}
TD.colon {COLOR: #000000; FONT-FAMILY: "MS Sans Serif", sans-serif; FONT-SIZE: 9pt}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta content="программирование на Visual Basic, документация, документы, delphi, pascal, cpp, hardware, web, веб-мастер, советы, описания, доки, manual, Java, C, C++, обучение, исходники, odbc, jdbc, programm, protocols, протоколы, общение, форумapplet, java, design, апплет, дизайн, ява, Free, counters, Trackers, Guestbooks, Access Logs, Banners, Graphics, Banner ads, Fonts, Form Mailer, form mailers, graphics, icons, games, freeware, shareware, forms, guestbooks, Java, Javascript, contests, puzzles, fonts, font resources, E-mail programs, reminder services, product samples, samples, Email services, E-mail services, advertising, graphics, free banner ads, free World Wide Web resources, counters, Trackers, Guestbooks, Access Logs, Banners, Graphics, Banner ads, Fonts, Form Mailer, form mailers, graphics, icons, games, freeware, shareware, forms, guestbooks, Java, Javascript, contests, puzzles, fonts, font resources, E-mail programs, reminder services, product samples, samples, Email services, E-mail services, advertising, graphics, free banner ads, free World Wide Web resources" name="keywords">
<meta NAME="RESOURCE-TYPE"
CONTENT="pop hypertext sources hypermedia server scripting shtml phtml html developer code base tools open source web site browser free software webmaster cgi dhtml dynamic content netscape explorer shareware download website construction free tutorial news design maintenance page hit cvs mailing list projects httpd mod_perl mod www htdig xml perl scripts script server-side-include apache database MySQL mysql msql postres postresql module linux online cpp Visual Basic JavaScript delphi wap job informer java opengl directx">
<title>Информационный сервер для программистов - исходники со всего света.</title>
</head>

<body topmargin="0" leftmargin="0" marginwidth="0" marginheigth="0" bgcolor=white>

<form action="/cgi-bin/sources/search/search.pl" method="get" align="left">
  <input type="hidden" name="stpos" value="0"><table border="0" cellpadding="0"
  cellspacing="0" width="750">
    <tr>
      <td valign="top" rowspan="2"><table border="0" cellpadding="0" cellspacing="0" width="287">
        <tr>
          <td colspan="2" bgcolor="#A5E4A7" valign="middle" align="center"><b>WWW.ИСХОДНИКИ.РУ</b></td>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">cpp.sources.ru</font></b></td>
        </tr>
        <tr>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">java.sources.ru</font></b></td>
          <td bgcolor="#C0C0C0" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>web.sources.ru</b></font></td>
          <td bgcolor="#A5E4A7" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>soft.sources.ru</b></font></td>
        </tr>
        <tr>
          <td bgcolor="#C0C0C0" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>jdbc.sources.ru</b></font></td>
          <td bgcolor="#A5E4A7" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>asp.sources.ru</b></font></td>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">api.sources.ru</font></b></td>
        </tr>
      </table>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td><font style="font-size: 8pt" size="2" face="Tahoma">&nbsp; Поиск по
          программированию :<br>
          </font>&nbsp; <input type="text" size="13" name="query"> <input type="submit"
          value="Поиск"><font size="1"><input
          TYPE="Radio" NAME="stype" VALUE="AND" checked>&quot;AND&quot; <input TYPE="Radio"
          NAME="stype" VALUE="OR">&quot;OR&quot;</font>


<!--TopList COUNTER--><a target=_top
href="http://top.list.ru/jump?from=89876"><script language="JavaScript"><!--
d=document;a='';a+=';r='+escape(d.referrer)
js=10//--></script><script language="JavaScript1.1"><!--
a+=';j='+navigator.javaEnabled()
js=11//--></script><script language="JavaScript1.2"><!--
s=screen;a+=';s='+s.width+'*'+s.height
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth)
js=12//--></script><script language="JavaScript1.3"><!--
js=13//--></script><script language="JavaScript"><!--
d.write('<img src="http://top.list.ru/counter'+
'?id=89876;t=57;js='+js+a+';rand='+Math.random()+
'" alt="TopList" '+ 'border=0 height=1 width=1>')
if(js>11)d.write('<'+'!-- ')//--></script><noscript><img
src="http://top.list.ru/counter?js=na;id=89876;t=57"
border=0 height=1 width=1
alt="TopList"></noscript><script language="JavaScript"><!--
if(js>11)d.write('--'+'>')//--></script></a><!--TopList COUNTER-->


<a href="http://counter.rambler.ru/top100/"><img src="http://counter.rambler.ru/top100.cnt?163871" alt="Rambler's Top100" width=1 height=1 border=0></a>

<!-- SpyLOG f:0211 --> 
<script language="javascript"> 
u="u1624.10.spylog.com";d=document;nv=navigator;na=nv.appName;p=1; 
bv=Math.round(parseFloat(nv.appVersion)*100); 
n=(na.substring(0,2)=="Mi")?0:1;rn=Math.random();z="p="+p+"&rn="+rn;y=""; 
y+="<a href='http://"+u+"/cnt?f=3&p="+p+"&rn="+rn+"' target=_blank>"; 
y+="<img src='http://"+u+"/cnt?"+z+ "&r="+escape(d.referrer)+"&pg="+escape(window.location.href)+"' border=0 width=1 height=1 alt='SpyLOG'>"; 
y+="</a>"; d.write(y);if(!n) { d.write("<"+"!--"); }//--></script><noscript> 
<a href="http://u1624.10.spylog.com/cnt?f=3&p=1" target=_blank> 
<img src="http://u1624.10.spylog.com/cnt?p=1" alt='SpyLOG' border='0' width=1 height=1 > 
</a></noscript><script language="javascript1.2"><!-- 
if(!n) { d.write("--"+">"); }//--></script> 
<!-- SpyLOG -->


</td>
        </tr>
      </table>
      </td>
      <td align="center"><font style="font-size: 15pt" color="#4904B1" size="4"
      face="Times New Roman">Информационный сервер</font></td>
    </tr>
    <tr>
      <td>


<!-- LBE -->
<script>
// <!--
rand = Math.round((Math.random() * (10000 - 1)));
document.write("<a href=http://www.lbe.ru/cgi-bin/href/castle?" + rand + " target=_blank><img src=http://www.lbe.ru/cgi-bin/banner/castle?" + rand + " width=468 height=60 border=0 alt=LBE ismap></a><br>");
// -->
</script>
<noscript>
                                                                                                                                                                <br>
</noscript>
<!-- LBE -->



      </td>
    </tr>
    <tr>
      <td colspan="2"><table border="0" cellpadding="0" cellspacing="1" width="100%">
        <tr>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a
          href="../www.sources.html"><font color="#000000" size="2">На главную</font></a></td>
          <td align="center" width="20%" bgcolor="#E0E0C6"><a
          href="../subscribe.html"><font color="#000000" size="2">Подписаться на новости</font></a></td>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a href="../cgi-bin/sources/Ultimate.pl"><font color="#000000" size="2">Форум</font></a></td>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a href="../books.html"><font color="#000000" size="2">Книги</font></a></td>
          <td align="center" width="7%" bgcolor="#E0E0C6"><a href="http://chat.vidcenter.ru:82/"><font color="#000000" size="2">Чат</font></a></td>
          <td align="center" width="13%" bgcolor="#E0E0C6"><a href="http://www.countries.ru/"><font color="#000000" size="2">Страны мира</font></a></td>
          <td align="center" width="29%" bgcolor="#E0E0C6"><b>5</b> пользователей на сервере.
</td>
        </tr>
      </table>
      </td>
    </tr>
  </table>
</form>

<div align="center"><center>

<table width="680" cellspacing="0" cellpadding="0">
  <tr>
    <td><hr>
    <h3>Распаковщик иконок</h3>
    <p>Автор: <b><a href="mailto:ptorro@hotmail.com">George Anescu</a> </b><ul>
      <li><a href="iconextract.zip">Скачать демо-проект - 24 Kb</a> </li>
    </ul>
    <h2>Описание</h2>
    <p>Наверное Вы иногда замечали, что в некоторых
    приложения сидят красивые иконки. И, наверное,
    Вам тоже хотелось поместить эти иконки в свою
    программу. Давайте посмотрим - как просто можно
    это сделать.</p>
    <p>Проект представляет собой shell расширение,
    которое добавляет два пункта во всплывающее меню
    при нажатии правой кнопкой на .exe или .dll файл в
    Windows Explorer. Первый пункт меню для распаковки
    больших иконок, а второй - для маленьких иконок.</p>
    <p>При нажатии на эти менюшки, информация о иконке
    (большая или маленькая) сопируется в clipboard,
    используя формат <code>BITMAP</code>. Далее можно
    скопировать содержимое буфера обмена в
    графический редактор.</p>
    <h2>Как получить из файла информацию об иконке</h2>
    <p>Все необходимые действия включены в функции <code>QueryContextMenu()</code>
    и <code>InvokeCommand()</code> интерфейса <code>IContextMenu</code>. Для
    получения обработчиков иконок используем
    следующую функцию: </p>
    <pre>UINT ExtractIconEx(LPCTSTR lpszFile, int nIconIndex, 
               HICON FAR *phiconLarge, HICON FAR *phiconSmall, UINT nIcons)
</pre>
    <p>которая позволяет распакавать иконки из
    исполняемых файлов, динамических библиотек (DLL),
    или файлов-иконок. Так же можно использовать
    функцию <code>ExtractIcon()</code> , но она может
    распаковывать только большие иконки. Итак для
    начала нам необходимо определить - присутствуют
    ли иконки в файле. Для этого в функции <code>QueryContextMenu()</code>
    вызываем <code>ExtractIconEx()</code> с параметром <code>nIconIndex</code>
    равным -1 и параметрами <code>phiconLarge</code> и <code>phiconSmall</code>
    установленными в NULL: </p>
    <pre>int nIcons = (int)ExtractIconEx(m_szFile, -1, NULL, NULL, 0);
</pre>
    <p>Если возвращённое значение больше чем 0 то
    тогда вставляем во всплывающее меню пункты для
    больших и маленьких иконок. Таким образом наша
    shell примочка оперирует со всеми файлами, но
    пункты меню будут добавлены только для файлов,
    содержащих иконки. И наконец в функции <code>InvokeCommand()</code>
    получаем обработчики на оба типа иконок
    следующим образом: </p>
    <pre>HICON hIconLarge, hIconSmall;
ExtractIconEx(m_szFile, 0, &amp;hIconLarge, &amp;hIconSmall, 1);
</pre>
    <p>Информацию об иконке распаковывается в
    структуру <code>ICONINFO</code> используя функцию <code>GetIconInfo()</code>
    следующим образом: </p>
    <pre>ICONINFO oIconInfo;
GetIconInfo(hIconLarge, &amp;oIconInfo);
</pre>
    <p>Структура <code>ICONINFO</code> имеет поле <code>hbmColor</code>
    типа <code>HBITMAP</code> которое и указывает на <code>BITMAP</code>
    структуру. Используя этот указатель мы можем
    скопировать информацию о битмапе в clipboard: </p>
    <pre>BOOL bOpen = ::OpenClipboard(NULL);
if(TRUE==bOpen)
{
  ::EmptyClipboard();
  ::SetClipboardData(CF_BITMAP, oIconInfo.hbmColor);
  ::CloseClipboard();
}
</pre>
    <p>В заключение, после того как мы прекращаем
    использовать указатели на иконки, необходимо
    уничтожить их вызовом функции <code>DestroyIcon()</code>: </p>
    <pre>DestroyIcon(hIconLarge);
DestroyIcon(hIconSmall);
</pre>
    <p>А теперь давайте посмотрим на полный код
    функций <code>QueryContextMenu()</code> и <code>InvokeCommand()</code>: </p>
    <pre>// IContextMenu
HRESULT CIconExtractObj::QueryContextMenu(HMENU hmenu, 
                UINT uMenuIndex, UINT uCmdID, UINT uidLastCmd, UINT uFlags)
{
  //If the flags include CMF_DEFAULTONLY then we shouldn't do anything
  if(uFlags &amp; CMF_DEFAULTONLY)
    return MAKE_HRESULT(SEVERITY_SUCCESS, FACILITY_NULL, 0);
  int nMenus = 0;
  //Количество иконок в файле
  int nIcons = (int)ExtractIconEx(m_szFile, -1, NULL, NULL, 0);
  if(nIcons &gt; 0)
  {
    InsertMenu(hmenu, uMenuIndex, MF_STRING | MF_BYPOSITION, 
                                uCmdID++, _T(&quot;Extract &amp;Large Icon&quot;));
    if(NULL != m_hExtractBmpL)
      SetMenuItemBitmaps(hmenu, uMenuIndex, MF_BYPOSITION,
                                              m_hExtractBmpL, NULL);
    uMenuIndex++;
    InsertMenu(hmenu, uMenuIndex, MF_STRING | MF_BYPOSITION,
                                 uCmdID++, _T(&quot;Extract &amp;Small Icon&quot;));
    if(NULL != m_hExtractBmpS)
      SetMenuItemBitmaps(hmenu, uMenuIndex, MF_BYPOSITION,
                                                m_hExtractBmpS, NULL);
    uMenuIndex++;
    nMenus = 2;
  }
  return MAKE_HRESULT(SEVERITY_SUCCESS, FACILITY_NULL, nMenus);
}
</pre>
    <p>&nbsp; </p>
    <pre>HRESULT CIconExtractObj::InvokeCommand(LPCMINVOKECOMMANDINFO pCmdInfo)
{
  // Если lpVerb реальный указатель на строку,
  // то пропускаем данную функцию и выходим
  if(0 != HIWORD( pCmdInfo-&gt;lpVerb))
    return E_INVALIDARG;
  //Распаковываем первую иконку
  HICON hIconLarge, hIconSmall;
  ExtractIconEx(m_szFile, 0, &amp;hIconLarge, &amp;hIconSmall, 1);
  ICONINFO oIconInfo;
  switch(LOWORD(pCmdInfo-&gt;lpVerb))
  {
    case 0:
      GetIconInfo(hIconLarge, &amp;oIconInfo);
      break;

    case 1:
      GetIconInfo(hIconSmall, &amp;oIconInfo);
      break;

    default:
      return E_INVALIDARG;
  }
  BOOL bOpen = ::OpenClipboard(NULL);
  if(TRUE==bOpen)
  {
    ::EmptyClipboard();
    ::SetClipboardData(CF_BITMAP, oIconInfo.hbmColor);
    ::CloseClipboard();
  }
  //Destroy the icons
  DestroyIcon(hIconLarge);
  DestroyIcon(hIconSmall);
  return S_OK;
}
</pre>
    <p><br>
    </td>
  </tr>
</table>
</center></div>


<hr>
<div align="center"><center>

<table border="0" cellpadding="0" cellspacing="3" width="468">
  <tr>
    <td width="154"><!-- LBE_LITE --> <script>
// <!--
rand = Math.round((Math.random() * (10000 - 1)));
document.write("<a href=http://lite.lbe.ru/cgi-bin/href/castle?" + rand + " target=_blank><img src=http://lite.lbe.ru/cgi-bin/banner/castle?" + rand + " width=468 height=60 border=0 alt=LBE_LITE ismap></a><br>");
// -->
</script> <noscript> <br>
</noscript><!-- LBE_LITE --></td>
  </tr>
</table>
</center></div>
</body>
</html>
