<HTML>
<HEAD>
<TITLE>WTSoft &#151; White Tiger WWW Board to 2.1(x)b upgrade</TITLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#BFDCFB" LINK="#0000f0" VLINK="#5E5E5E" ALINK="#FF0000">

<font face="Times New Roman" size=4>
<div align=left>
<center><P><B><FONT COLOR=#0000FF SIZE=+2>White Tiger<BR>
</FONT><I><FONT COLOR=#008000 SIZE=+1>WWW Board &#151; система поддержки WWW-конференции
<p>Руководство по переходу на последнюю версию скриптов</FONT></I></B></CENTER>
<P><hr size=1 width=80% align=center><P>
<i><ul><li><a href=#from13b>Переход до версии 1.4b</a>
<li><a href=#from14b>Переход до версии 1.5b</a>
<li><a href=#to153b>Дополнение до версии 1.53b</a>
<li><a href=#to20b>Переход до версии 2.0b</a>
<li><a href=#to21b>Переход до версии 2.1b</a>
</ul></i>
<P><hr size=1 width=80% align=center><P>

<center><h3><a name=from13b></a>С до версии 1.4b</h3></center>
<dd>В версии White Tiger WWW Board 1.4b были произведены некоторые изменения,
направленные на повышение устойчивости форума, а также введены дополнительные
операции, позволяющие восстановить утерянный или поврежденный основной лист сообщений.
<dd>Подобная утрата может произойти по самым различным, порой непонятным причинам.
Возможно банальное исчерпание лимита отведенного на диске сервера пространства,
тогда при очередном обновлении Index-файл просто не сохраняется. В прежних
версиях счетчик сообщений находился в файле с данными форума, который подобно
Index-файлу перезаписывался при каждом новом письме, и поэтому мог быть потерян
в результате сбоя, как и основной лист.
<dd>По этой причине счетчик был вынесен в отдельный файл.
<dd>Другое принципиальное изменение состоит в том, что теперь все пути к
каталогам форума являются переменными, определяемыми в файле данных (кроме
пути к каталогу, содержащему сами файлы данных; он определяется в начале
каждого скрипта).
<br><br>
<dd>Итак, прежде чем обновить скрипты, внесите необходимые изменения в файлы данных.
<dd>Скачайте с сервера (по ftp) файл &lt;wtboard.txt&gt; и произведите в нем следующие
изменения:
<ul>
<li>dirkonf &#151; добавьте перед значением ../ (например, было: <font face="Courier New Cyr" size=3><b>dirkonf=wtboard</b></font>,
стало: <font face="Courier New Cyr" size=3><b>dirkonf=../wtboard</b></font>).
Можно вписать и полный виртуальный (через Интернет) путь к каталогу форума.
<li>dirrealkonf &#151; добавьте перед значением ../ (<font face="Courier New Cyr" size=3><b>dirrealkonf=wtboard</b></font> &#151;>
<font face="Courier New Cyr" size=3><b>dirrealkonf=../wtboard</b></font>).
Можно вписать и полный физический (на жестком диске) путь к каталогу форума.
<li>dircgi &#151; добавьте перед значением ../ (<font face="Courier New Cyr" size=3><b>dircgi=cgi-bin</b></font> &#151;> <font face="Courier New Cyr" size=3><b>dircgi=../cgi-bin</b></font>).
Можно вписать и полный путь к каталогу скриптов.
<li>realpath= &#151; установите значение .. (<font face="Courier New Cyr" size=3><b>realpath=</b></font> &#151;> <font face="Courier New Cyr" size=3><b>realpath=..</b></font>). Или
другое, в соответствии со значением dirrealkonf. Это должна быть разница
между dirrealkonf и названием каталога форума. К примеру, если название каталога
форума <font face="Courier New Cyr" size=3><b>wtboard</b></font>, а <font face="Courier New Cyr" size=3><b>dirrealkonf=c:/www/user/root/forum/wtboard</b></font>, то значение:
<font face="Courier New Cyr" size=3><b>realpath=c:/www/user/root/forum</b></font>.
<dd>Слешей (символов &#171;/&#187;) в конце переменных быть не должно.
Указывать полные пути целесообразно, когда каталог со скриптами находится в
отдельном разделе сервера, не параллельно с каталогом форума.
<li>После переменной quote вставьте новую строку с переменной substip, присвойте ей значение
&#171;on&#187; (<font face="Courier New Cyr" size=3><b>substip=on</b></font>), чтобы разрешить подстановку имен и адресов
в зависимости от IP-адреса или &#171;off&#187; (<font face="Courier New Cyr" size=3><b>substip=off</b></font>), чтобы запретить
такую подстановку.
<li>Проверьте контекстно наличие фрагмента <font face="Courier New Cyr" size=3><b>../$dir</b></font> и везде, где
он присутствует, удалите <font face="Courier New Cyr" size=3><b>../</b></font>, должно остаться только <font face="Courier New Cyr" size=3><b>$dir</b></font>.
<li>Между ссылкой на отправление сообщения и на правила форума (хотя вы можете найти
и другое место) вставьте следующий фрагмент:
<br><font face="Courier New Cyr" size=3><b>[&lt;a href=service.shtml&gt;Сервис&lt;/a&gt;]</b></font><br>
для получения доступа к сервисным функциям.
<li>Узнайте значение счетчика (переменная lastmes) и создайте файл &lt;wtblast.txt&gt;,
в который впишите это число, прдварительно увеличив его на несколько позиций &#151;
для гарантии на два-три десятка, чтобы исключить возможность потери сообщений,
появившихся на форуме, пока вы занимались его обновлением.
</ul>
<dd>После произведения перечисленных изменений закачайте на форум вначале файлы данных
(не забудьте объявить их читаемыми и записываемыми), после чего можно
обновить скрипты.
<dd>Файл service.shtml следует поместить в каталог html-файлов форума,
предварительно удалив из него лишние строки.
<dd>Далее войдите через ваш административный вход в пункт &#171;Изменение
интерфейса&#187; и, ничего не изменяя, нажмите кнопку &#171;Послать&#187;.
<dd>Войдите еще раз, на этот раз в пункт &#171;Сервис восстановления Index&#187; и
нажмите кнопку &#171;Генерировать структуру&#187;. После этого проверьте
в каталоге data на сервере наличие файла &lt;wtbstruct.txt&gt;. Если его нету,
создайте, присвойте права читаемости и записываемости, после чего повторите
генерацию структуры.
<dd><i>Теперь ваш форум совместим с версией 1.4b. Чтобы проапгрейдить его
до версии 1.5b, выполните следующие инструкции.</i>

<p><hr size=1 width=40% align=center><P>

<center><h3><a name=from14b></a>Переход до версии 1.5b</h3></center>
<dd>Добавьте в файл &lt;wtboard.txt&gt; следующие строки:
<ul><li><font face="Courier New Cyr" size=3><b>ofkonf=&lt;Форума&gt;</b></font>,
вместо &lt;форума&gt; впишите название вашего форума в родительном падеже;
<li><font face="Courier New Cyr" size=3><b>setsize=on</b></font> для автоматической
подстановки размера сообщения в Index-лист или
<font face="Courier New Cyr" size=3><b>setsize=off</b></font> для отказа от таковой;
<li><font face="Courier New Cyr" size=3><b>addip=on</b></font> для автоматической
подстановки IP-адреса отправителя письма в сообщение или
<font face="Courier New Cyr" size=3><b>addip=off</b></font> для отказа от таковой.
Рекомендуется использовать вариант off (установка по умолчанию), так как посетителей может отпугнуть
открытая публикация их IP-адресов;
<li><font face="Courier New Cyr" size=3><b>info=&lt;Информация о форуме&gt;</b></font> &#151;
здесь можно вписать любую информацию о вашем форуме, которая будет отображаться при
вызове сервисной функции &#171;О форуме&#187;. Позднее данный пункт можно
изменить через функции администрирования. Следите, чтобы, как и везде, значение
занимало одну строку;
<li><font face="Courier New Cyr" size=3><b>userstat=on</b></font> для публикации
списка участников форума при вызове пункта сервиса &#171;Статистика форума&#187;
или <font face="Courier New Cyr" size=3><b>userstat=off</b></font> для отказа
от таковой. Рекомендуется состояние &#171;on&#187;;
<li><font face="Courier New Cyr" size=3><b>ipuserstat=on</b></font> для
публикации в статистике вместе с именами участников форума их IP-адресов или
<font face="Courier New Cyr" size=3><b>ipuserstat=off</b></font> для запрещения
такой возможности. Рекомендуется состояние &#171;off&#187;;
<li><font face="Courier New Cyr" size=3><b>ignorstat=on</b></font> для
разрешения отображения в статистике форума списка игнорируемых хостов
или <font face="Courier New Cyr" size=3><b>ignorstat=off</b></font> для
запрещения такой возможности. Рекомендуется состояние &#171;on&#187;.
<li>Измените в строке begarchive фрагменты <font face="Courier New Cyr" size=3><b>$onkonf</b></font>
на <font face="Courier New Cyr" size=3><b>$ofkonf</b></font>.
<li>Измените в строке begindex фрагмент <font face="Courier New Cyr" size=3><b>&lt;!--#exec&nbsp;cgi=$dircgi/wtbnews.cgi&nbsp;--&gt;</b></font>
на <font face="Courier New Cyr" size=3><b>&lt;!--#include&nbsp;virtual="$dircgi/wtbservice.cgi?fid=$fid&ins=news"--&gt;</b></font>, это обусловлено
перенесением функций скрипта wtbnews.cgi в скрипт wtbservice.cgi. Кроме того,
им же выполняется недопущение пользователя к форуму вообще.
</ul>
<dd>Далее обновите файл &lt;wtboard.txt&gt; на сервере. В файле &lt;wtbini.txt&gt;
произведите соответствующие изменения названий конфигурационных файлов форума,
поменяйте само название этого файла и скопируйте на сервер. В скриптах пропишите
путь к каталогу &lt;data&gt; и новое название файла &lt;wtbini.txt&gt;. <i>(Кстати,
каталог &lt;data&gt; может находиться в любом месте сервера, также и недоступном
для браузеров.)</i> Скопируйте на сервер также файл &lt;wtblang.txt&gt;, содержащий
все языковые конструкции форума (сообщения, добавления, примечания), после
чего можете обновлять сами скрипты. Перед этим рекомендуем сохранить старые
версии скриптов на тот случай, если новые не будут работать нормально.
<dd>Войдя через администрирование на страницу изменения элементов интерфейса,
без исправлений согласитесь со всеми пунктами. После этого будут приняты
соответствующие изменения главной страницы форума.
<dd>Перед тем, как обновлять файл service.shtml, его необходимо подредактировать.
Внутри него есть строчки, рассчитанные как на работу SSI, так и на ее отсутствие.
Если SSI у вас не работает, то и беспокоиться нечего, если же подключен
и работает, тогда необходимо удалить оговоренные в самом файле строки.
<dd>Для подключения второго, третьего и т. д. форумов на базе одной копии скриптов
необходимо выполнить действия, описанные в <a href=wtboard.htm>документации</a>.
<dd><i>Обновление с версий 1.5b, 1.51b и 1.52b до 1.53b описано ниже.</i>

<p><hr size=1 width=40% align=center><P>

<center><h3><a name=to153b></a>До версии 1.53b</h3></center>
<dd>В версии 1.53b введены новые опции, определяющие работу форума.
<dd>Добавьте в файл &lt;wtboard.txt&gt; следующие строчки:
<ul><li><font face="Courier New Cyr" size=3><b>notag=N</b></font>,
здесь <b>N</b> принимает значения от 0 до 2 и тем самым предписывает
производить следующие операции над html-тегами, включенными в тело сообщения:
<ul><li><b>0</b> &#151; оставлять все теги как есть;
<li><b>1</b> &#151; преобразовывать все теги в теле сообщения в текст;
<li><b>2</b> &#151; удалять все теги из тела сообщения.</ul>
<li><font face="Courier New Cyr" size=3><b>usecookie=on</b></font> &#151; для
использования cookies при идентификации пользователя, при этом сначала
производится идентификация по cookies, а затем, если она не прошла, по IP-адресу;
или <font face="Courier New Cyr" size=3><b>usecookie=off</b></font> &#151;
для отключения использования cookies.
<li><font face="Courier New Cyr" size=3><b>quoting=on</b></font> &#151; для
цитирования предыдущего письма при ответе;
или <font face="Courier New Cyr" size=3><b>quoting=off</b></font> &#151;
для отключения цитирования.
</ul>

<p><hr size=1 width=40% align=center><P>

<center><h3><a name=to20b></a>До версии 2.0b</h3></center>
<dd>В версии 2.0b введены новые опции, определяющие работу форума. Часть из них
относится к установкам индивидуальных настроек форума. Если вы не дополните
файл &lt;wtboard.txt&gt; согласно нижеследующим инструкциям, будут
использоваться значения по умолчанию, причем изменение их через административный
раздел произвести будет невозможно.
<dd>Чтобы возможно было изменять новые параметры через раздел администрирования,
добавьте в файл &lt;wtboard.txt&gt; следующие строчки:
<ul><li><font face="Courier New Cyr" size=3><b>includeform=off</b></font> для
запрещения вывода формы ответа на сообщение прямо в нем или
<font face="Courier New Cyr" size=3><b>includeform=on</b></font> &#151; для
разрешения. Во втором случае значение <font face="Courier New Cyr" size=3><b>ext</b></font>
(см. ниже) должно быть определено как <font face="Courier New Cyr" size=3><b>shtml</b></font>.
Значение по умолчанию &#151; off.
<li><font face="Courier New Cyr" size=3><b>ext=XXX</b></font>, здесь
<font face="Courier New Cyr" size=3><b>XXX</b></font> &#151; одно из четырех
значений:
<ul><li><b>htm</b>;
<li><b>html</b> &#151; значение по умолчанию в предыдущих версиях программы;
<li><b>shtml</b> &#151; значение по умолчанию, начиная с версии 2.0;
<li><b>stm</b> &#151; аналог shtml на некоторых системах.
</ul>
<dd>Значение shtml может потребоваться для реализации автоматического добавления
формы ответа на сообщение, вставки баннера и т. д. &#151; вещей, которые реализуются
посредством SSI.
<li><font face="Courier New Cyr" size=3><b>reply=Re</b></font> &#151; фрагмент,
автоматически вставляющийся перед названием темы при цитировании. Значение
по умолчанию &#151; &#171;Re&#187;.
<li><font face="Courier New Cyr" size=3><b>paragraph=&lt;dd&gt;</b></font> &#151;
тег или совокупность тегов, определяющих начало абзаца в генерируемых сообщениях.
<li><font face="Courier New Cyr" size=3><b>hr=&lt;hr size=1 width=80% align=center&gt;</b></font> &#151;
тег, определяющий разделитель в файлах. По умолчанию &#151; горизонтальная черта
шириной 80% экрана, толщиной 1 пиксель. Можно переопределить в какой-либо другой,
например, графический файл сходной направленности. Этому параметру контекстно
соответствует ключ <font face="Courier New Cyr" size=3><b>$separator</b></font>
в прочих переменных форума.
<li><font face="Courier New Cyr" size=3><b>selectnew=360</b></font> &#151;
значение, определяющее количество минут, в течение которых сообщение будет
отмечаться на основной странице значком &#171;NEW&#187;. При равном нулю
отмечания производиться не будет. Значение по умолчанию &#151; 360 (6&nbsp;часов).
<li><font face="Courier New Cyr" size=3><b>selecttag=XXX</b></font>,
здесь <font face="Courier New Cyr" size=3><b>XXX</b></font> &#151; определенный
вами признак, которым будут помечаться новые сообщения. По умолчанию
<font face="Courier New Cyr" size=3><b>&lt;img src="$dirkonf/new.gif" height=15 width=30 border=0&gt;</b></font>,
при этом в каталоге с html-файлами форума должен находиться графический
файл new.gif. В этой переменной контекстно заменяются конструкции типа $dirkonf,
$dircgi, $thekonf и т. д., включая ключевые слова, определяющие цвета форума. 
Зачем это нужно &#151; неизвестно. Пусть будет...
<li><font face="Courier New Cyr" size=3><b>selectnul=on</b></font> для включения
цветового выделения ссылок на пустые (не содержащие никакой информации в теле) сообщения,
и <font face="Courier New Cyr" size=3><b>selectnul=off</b></font> для отключения
этой возможности.
<li><font face="Courier New Cyr" size=3><b>nulcolor=#0000ff</b></font> &#151;
цвет ссылок на пустые сообщения.
</ul>


<p><hr size=1 width=40% align=center><P>

<center><h3><a name=to21b></a>До версии 2.1b</h3></center>
<dd>В версии 2.1b добавлено несколько новых опций.
<dd>Добавьте в файл &lt;wtboard.txt&gt;, раздел [Board Options] следующие строчки:
<ul><li><font face="Courier New Cyr" size=3><b>quotebeg=&lt;i&gt;</b></font> 
в качестве открывающего тега цитаты.
<li><font face="Courier New Cyr" size=3><b>quoteend=&lt;/i&gt;</b></font> в
качестве закрывающего тега цитаты.
<dd>Естественно, вы вправе изменить эти теги или дополнить, однако будьте внимательны:
неправильное использование пары открывающих/закрывающих тегов может привести
к неполадкам в работе форума.
<li><font face="Courier New Cyr" size=3><b>seturl=on</b></font> для разрешения
добавления полей ссылок в формы создания сообщений или 
<font face="Courier New Cyr" size=3><b>seturl=off</b></font> для запрещения
этого. Значение по умолчанию <font face="Courier New Cyr" size=3><b>on</b></font>,
</ul>

<dd>Замените также файл &lt;wtblang.txt&gt; на сервере на новый.
<dd>Измените в новых файлах *.cgi переменные, указанные в самом начале,
на определенные вами. Обновите их на сервере.
<br><br>

<dd>На этом обновление завершено. Сделайте для проверки несколько тестовых сообщений.
Проследите, не записываются ли они под одним и тем же номером. Если так происходит,
проверьте все обозначенные права доступа файлов на сервере.


<P><hr size=1 width=80% align=center><P>

<CENTER><P><B><TT><A HREF="wtboard.htm">назад</A></TT></B></P></CENTER>
<B><I><P><FONT SIZE="-1">Copyright &#169; 1998-1999, <A HREF="mailto:wtiger@mail.ru">White Tiger</a>
</BODY>
</HTML>
