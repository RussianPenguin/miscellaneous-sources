<HTML>
<HEAD>
<TITLE>White Tiger WWW Board &#151; Информация для разработчика</TITLE>

<style type="text/css">
td {font-family: tahoma; font-size: 20px}
</style>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#BFDCFB" LINK="#0000f0" VLINK="#5E5E5E" ALINK="#FF0000">

<font face="Arial, Times New Roman" size=2>
<div align=left>
<div align=justify>
<center><P><B><FONT COLOR=#0000FF SIZE=+2>White Tiger<BR>
</FONT><I><FONT COLOR=#008000 SIZE=+1>WWW Board &#151; система поддержки WWW-конференции<p>Информация для разработчика</FONT></I></B></CENTER>

<P><hr size=1 width=80% align=center><P>
<center>[<a href=ewtboard.htm>English version here</a>]
[<a href=wtboard.htm>Документация</a>]
[<a href=http://wtiger.ncport.ru/wtboard>Демонстрация</a>]
[<a href=wtboardhome.htm>Тестирование</a>]
[<a href=wtb2new.htm>Обновление</a>]
[Разработка]
</center>
<P><hr size=1 width=80% align=center><P>

<center><i>Внимание: документ еще не закончен. Его доработка будет производиться
постепенно, от версии к версии.</i></center>
<P><hr size=1 width=80% align=center><P>
<dd>1. <a href=#1>Введение</a>
<dd>2. <a href=#2>Некоторые принципы функционирования</a>
<dd>3. <a href=#3>Подпрограммы</a>
<dd>4. <a href=#4>Общие переменные</a>

<dd><a href=#app>Приложения</a>
<dd>&nbsp;&nbsp;&nbsp;&nbsp;1. <a href=#app1>Форматы HTML-файлов форума</a>
<dd>&nbsp;&nbsp;&nbsp;&nbsp;2. <a href=#app2>Форматы конфигурационных файлов</a>
<dd>&nbsp;&nbsp;&nbsp;&nbsp;3. <a href=#app3>Сценарий администратора</a>


<P><hr size=1 width=80% align=center><P>

<center><h3><a name=1></a>1. Введение</h3></center>

<dd>Система программной поддержки WWW-конференций White Tiger WWW Board
(далее WTBoard) в настоящее время имеет достаточно широкие возможности,
чтобы позволить пользователю с определенной степенью гибкости настроить форум.
Однако абсолютно все в одной программе реализовать невозможно. Разработчик
постепенно добавляет новые функции, но вы можете, не дожидаясь, пока это
произойдет (если произойдет вообще), реализовать собственный скрипт,
позволяющий достичь необходимого результата. Будем в дальнейшем называть такой
скрипт дополнительным модулем (plug-in).
<dd>Ниже описываются некоторые принципы функционирования WTBoard, понимание
которых необходимо для правильного написания plug-in. Также приведены
подпрограммы, доступные для общего использования, описываются параметры их
запуска и возвращаемые значения. Разработчик постарается в дальнейших
версиях сохранить совместимость API, однако такой гарантии не дает.



<br><br><br><p><center><h3><a name=2></a>2. Некоторые принципы функционирования</h3></center>

<dd>Все программные файлы WTBoard реализованы на Perl. Таким образом, для
создания plug-in вам нужно иметь некоторые навыки программирования на этом
языке, желательно версии 5.003 и выше.

<p>...<p>

<dd>Для использования общих подпрограмм WTBoard в вашем скрипте необходим
следующий оператор:
<center><font face=courier size=-1><b>require "wtbext.cgi";</b></font></center>
<dd>Это даст вашему скрипту предписание использовать общий модуль wtbext.cgi
и позволит обращаться к подпрограммам WTBoard.
<dd>Предварительно можно задать проверку на наличие этого файла и выход
при ошибке:
<center><font face=courier size=-1><b>if(!-e"wtbext.cgi"){print "\nError: not found wtbext.cgi";exit}</b></font></center>

<dd>Для инициализации параметров форума необходим вызов подпрограммы
<b>params</b> с параметром 5, то есть:
<center><font face=courier size=-1><b>params(5);</b></font></center>
Подпрограмма принимает в качестве входного единственный параметр,
определяющий некоторые особенности инициализации. Для плагинов рекомендуется
использовать значение 5; 1 используется основным скриптом, 2 &#151;
административным, 3 &#151; сервисным, при значении 4 инициализация не
производится, только устанавливается номер версии скрипта.
<dd>В результате полной отработки подпрограммы производится целый ряд
действий, в число которых входят задание параметров форума по умолчанию,
определение файлов данных активного форума в многофорумной системе, считывание
файла данных &lt;wtboard.txt&gt; и преобразование указанных параметров в
соответствующие переменные (различается в зависимости от ключа запуска
подпрограммы), создание хешей <b>%inip</b> и <b>%patp</b>, содержащих
параметры форума и шаблоны интерфейса соответственно, создание массивов
<b>@a</b> и <b>@cks</b> с декодированными и разделенными параметрами командной
строки, создание переменных со значениями соответственно командной строке,
анализ и задание рабочего шаблона индексной строки, дополнительная обработка
некоторых переменных, доступных для дальнейшего использования. В поставку
программы входит скрипт wtbdev.cgi, который, будучи установлен наравне
с остальными скриптами и запущен, выводит на экран весь спектр переменных
(названия и значения), создающихся при запуске params(5). Рекомендуется
не использовать для собственных переменных при разработке скриптов имена,
совпадающие с организованными в params, если только это не обусловлено
спецификой момента.

<p>...<p>

<dd>Обязательно проверяйте версию WTBoard. В основном осуществляется (но не
гарантируется) обратная совместимость. Совместимость прямая, естественно,
даже не ставится целью, WTBoard &#151; слишком динамичная программа для этого.
<dd>Проверка версии производится с использованием переменной
<b>$internalversion</b>, которая представляет собой четырехзначное число,
соответствующее внешней нумерации версий. Так, версия 2.82a имеет значение
2821, 2.82b &#151; 2822, 2.83b &#151; 2831 (так как альфа-версии не было) и т.
д. Новые версии выходят с увеличением номера, так что достаточно сравнения
$internalversion с наперед заданной вашей переменной.
<dd>Внешняя нумерация версий WTBoard хранится в переменной <b>$version</b>.
Текущую версию можно узнать из скрипта wtbext.cgi или &#171;холостым&#187;
запуском wtboard.cgi.

<p>...<p>

<dd>Для обозначения конца строки используйте символ &#171;\n&#187;. Это
позволит с большей гибкостью применять ваш модуль как под операционными
системами класса Unix, так и DOS/Windows. WTBoard оперирует также жестко
определенными окончаниями: <b>$cr</b> &#151; последовательность 0D0A (\r\n),
<b>$cl</b> &#151; символ 0A (\n) и <b>$crd</b> &#151; символ 0D (\r).

<p>...<p>

<dd>Для удобства администрирования вашего плагина воспользуйтесь подпрограммами
TITLEADMIN, OPTFIELD, OPTFIELD10, OPT2FIELD, OPTONOFF, OPTSUBMIT, OPTSELECT,
SAVEVALUE, VERIFYADMIN, SAVEWRONG. Посредством первых шести довольно просто
получается форма в духе стандартной административной формы программы. Пример
использования можно взять на сайте (плагин WTCitate). Подробное описание
вызова и параметров см. ниже.

<p>...<p>

<dd>Можно в параметры настроек пользователя добавить ключи, используемые вашим
плагином. Параметры регистрируются в базе совокупностью
символов-переключателей. При инициализации форума список параметров помещается
в переменную <b>$pars</b>, а также расшифровывается по отдельным переменным,
используемым основным скриптом.
<dd>Параметры задаются каждый одним символом. Используется несколько принципов
&#151; отсутствие параметра разрешает действие, отсутствие параметра запрещает
действие, либо переключает с одного варианта на другой. Ситуация по умолчанию
&#151; отсутствие параметра.
<dd>Для плагинов в переменной $pars символы помещаются после заглавной Z,
символы до нее используются самой WTBoard.
<dd>Вы можете добавить индивидуальные настройки своего плагина в общую форму
индивидуальных настроек, для этого воспользуйтесь <b>externalcall7</b> и
<b>externalcall8</b>, при этом параметр <b>externalcalls</b> нужно поставить
в положение <b>on</b>.

<p>...<p>

<dd>WTBoard при работе использует много переменных. Изначально не планировалась
возможность работы с plug-ins, поэтому какой-то четкой системы наименования
переменных нет до сих пор. Вполне может случиться так, что названия некоторых ваших
переменных совпадут с внутренними переменными программы, в результате чего
возможны непредсказуемые сбои в работе. Поэтому старайтесь именовать значения
так, чтобы они гарантированно не пересекались с базовыми. В частности, вы
можете добавлять к началу названия каждой переменной уникальный идентификатор,
например: <font face="Courier"><b>wwwpager_lpm_3=0</b></font>.
<dd>Наиболее часто применяются следующие названия: @i, @j, @a, @b, @ini, @s,
$s, $s1, $s2, $a, $cs, @cks и т. д. Переменные, объявленные к общему
использованию, можно увидеть в результате работы скрипта wtbdev.cgi,
поставляющегося в стандартном дистрибутиве.
<dd>Рекомендуется использовать хеши <b>%inip</b>, <b>%patp</b> и <b>%inis</b>,
содержащие большинство параметров форума. Все они также дублируются в одноименных
ключам хеша значениях, но в дальнейшем, возможно, это будет устранено.
Перечисленные хеши содержат следующие группы данных:
<ul><li><b>%inip</b> &#151; все неинтерполируемые параметры форума, плюс
настройки пользователя, плюс часть внутренних переменных программы, плюс
интерполируемые <b>begbody</b> и <b>endbody</b>;
<li><b>%patp</b> &#151; все интерполируемые параметры форума (т. е. шаблоны,
определенные в секции <b>[Board Strings]</b>; перед первым использованием
значения необходимо произвести его подготовку подпрограммой SUBSTIT (см. ниже);
<li><b>%inis</b> &#151; административный хеш, содержит все параметры форума
в неинтерполированном виде; значения из этого хеша используют подпрограммы
администрации &#151; OPTFIELD, OPTONOFF, OPTSELECT и т. д., он также должен
быть определен при изменении настроек пользователя.
</ul>

<br><br><br><p><center><h3><a name=3></a>3. Подпрограммы</h3></center>

<dd><b>PARAMS</b>. <i>Вызов:</i> <font face=courier size=-1><b>params($caller)</b></font>.
<dd><i>Ключи:</i> <b>$caller</b> &#151; идентификатор вызывающего процесса.
При $caller=2 ключи в шаблонах не интерполируются. Для plug-ins в общем случае
предназначен $caller=5.
<dd><i>Описание.</i> Подпрограмма считывания и определения всех параметров
форума. Список названий и значений переменных для конкретного форума можно
получить посредством установки и вызова скрипта wtbdev.cgi (расположение в
дистрибутиве docs/wtbdev.cgi).

<p>
<dd><b>SUBSTIT</b>. <i>Вызов:</i> <font face=courier size=-1><b>substit($value[,$value2])</b></font>.
<dd><i>Ключи:</i> <b>$value</b> &#151; интерполируемая строка;
<dd><b>$value2</b> &#151; (необязательный параметр) заменяющая строка.
<dd><i>Описание.</i> Подпрограмма подстановки значений на места ключевых
слов, встречающихся в обозначенной строке. Производится интерполяция по всем
ключам хеша %inip, оговоренным признаками $ или % <i>(например, "this is
sample reference %href text", &#151; если определен $inip{'href'}, то ключ %href
заменяется значением $inip{'href'})</i>, а также некоторых
дополнительных или динамически определенных переменных.
<dd>В случае, если длина $value2 больше нуля, $value заменяется им и
интерполируется как описано.

<p>
<dd><b>SAVEVALUE</b>. <i>Вызов:</i> <font face=courier size=-1><b>savevalue($section,$option,$value)</b></font>.
<dd><i>Ключи:</i> <b>$section</b> &#151; раздел &lt;wtboard.txt&gt;, в котором
определен параметр;
<dd><b>$option</b> &#151; наименование параметра;
<dd><b>$value</b> &#151; значение параметра, соответствует значению хеша
$inip{$option}.
<dd><i>Описание.</i> Подпрограмма сохранения параметра в файле конфигурации
форума &lt;wtboard.txt&gt;. При наличии параметра в конфигурационном файле его
значение заменяется новым. Если параметр отсутствует, ищется раздел, заданный
переменной $section, и параметр создается в нем. При отсутствии раздела сначала
создается он, затем параметр.

<p>
<dd><b>SAVECOPYRIGHT</b>. <i>Вызов:</i> <font face=courier size=-1><b>savecopyright($begin,$end,$value)</b></font>.
<dd><i>Ключи:</i> <b>$begin</b> &#151; признак начала фрагмента информации
об авторских правах, относящегося к данному плагину, рекомендуется что-то
вроде <b><font face="Courier">&lt;your-plugin&gt;</font></b>;
<dd><b>$end</b> &#151; признак конца этого фрагмента, рекомендуется что-то
вроде <b><font face="Courier">&lt;/your-plugin&gt;</font></b>;
<dd><b>$value</b> &#151; сама информация.
<dd><i>Описание.</i> Подпрограмма сохранения информации об авторских правах
плагина. Все копирайты плагинов хранятся в параметре copyright в файле настроек
&lt;wtboard.txt&gt;. Поэтому необходимо явное указание начала и конца вашего
фрагмента копирайта в этом параметре. Для этого рекомендуется использовать
тегоподобные идентификаторы, между которыми будет заключаться ваш фрагмент.

<p>
<dd><b>VERIFYADMIN</b>. <i>Вызов:</i> <font face=courier size=-1><b>$mod=verifyadmin($login,$password)</b></font>.
<dd><i>Ключи:</i> <b>$mod</b> &#151; права доступа администратора;
<dd><b>$login</b> &#151; входное имя администратора;
<dd><b>$password</b> &#151; пароль администратора.
<dd><i>Описание.</i> Подпрограмма верификации администратора с указанными
login и password. Сверяет названные данные с учетными записями форума и выдает
результат. При отсутствии учетной записи или неверном пароле возвращается -1
($mod=-1), при полном доступе 0, в остальных случаях устанавливается строковая
переменная, содержащая идентификаторы прав доступа администратора. Соответствующие
права имеются, если идентификатор определен. Возможны следующие идентификаторы:
<font size=-1><multicol cols=2 gutter=40><B>a</b> &#151; все привилегии;
<br><b>i</b> &#151; элементы интерфейса; <br><b>g</b> &#151; список
игнорируемых хостов (игнор-лист), просмотр логов; <br><b>h</b> &#151; архивация форума;
<br><b>e</b> &#151; редактирование файлов форума; <br><b>d</b> &#151;
удаление сообщений; <br><b>n</b> &#151; создание и удаление новостных строк; <br><b>s</b>
&#151; работа со структурой, восстановление основной страницы.</multicol></font>
<dd>Единственный идентификатор <b>a</b> заменяет все вышеперечисленные,
а также добавляет возможность изменения списка и правд доступа администраторов.

<p>
<dd><b>SAVEWRONG</b>. <i>Вызов:</i> <font face=courier size=-1><b>savewrong('EVENT',$login,$password,$email,$misc)</b></font>.
<dd><i>Ключи:</i> <b>EVENT</b> &#151; пятибуквенный идентификатор, как-либо
обозначающий событие;
<dd><b>$login</b> &#151; имя клиента, при котором произошло событие;
<dd><b>$password</b> &#151; пароль клиента;
<dd><b>$email</b> &#151; адрес электронной почты клиента;
<dd><b>$misc</b> &#151; какая-либо иная информация, необходимая для регистрации.
<dd><i>Описание.</i> Подпрограмма записи критических событий форума в файл
&lt;wtwrong.txt&gt;: архивации, регистрации нового участника, неверных паролей
участников и администраторов, попыток несанкционированного доступа и т. д.

<p>
<dd><b>TITLEADMIN</b>. <i>Вызов:</i> <font face=courier size=-1><b>titleadmin('MODE',$login,$stat)</b></font>.
<dd><i>Ключи:</i> <b>MODE</b> &#151; режим администрирования;
<dd><b>$login</b> &#151; имя администратора;
<dd><b>$password</b> &#151; права доступа администратора.
<dd><i>Описание.</i> Подпрограмма вывода шапки административного раздела.

<p>
<dd><b>OPTONOFF</b>. <i>Вызов:</i> <font face=courier size=-1><b>optonoff('PARAMETER',$title,$desc)</b></font>.
<dd><i>Ключи:</i> <b>PARAMETER</b> &#151; наименование ключа хеша %inis, сопоставленного с параметром, которому присваивается либо значение <b>on</b>, либо значение <b>off</b>;
<dd><b>$title</b> &#151; название параметра;
<dd><b>$desc</b> &#151; описание (комментарий).
<dd><i>Описание.</i> Подпрограмма вывода элемента формы администрирования для
определения значения двоичного параметра. Необходимо предварительное задание
тега формы и тега таблицы с шестью столбцами.

<p>
<dd><b>OPTFIELD</b>. <i>Вызов:</i> <font face=courier size=-1><b>optfield('PARAMETER',$title,$desc)</b></font>.
<dd><i>Ключи:</i> <b>PARAMETER</b> &#151; наименование ключа хеша %inis, сопоставленного с параметром;
<dd><b>$title</b> &#151; название параметра;
<dd><b>$desc</b> &#151; описание (комментарий).
<dd><i>Описание.</i> Подпрограмма вывода элемента формы администрирования для
определения значения строкового параметра. Задается поле шириной 40 символов.
Необходимо предварительное задание тега формы и тега таблицы с шестью столбцами.

<p>
<dd><b>OPTFIELD10</b>. <i>Аналогично <b>OPTFIELD</b>, с тем отличием, что отображается
поле ввода длиной 10 символов.</i>

<p>
<dd><b>OPTFIELD20</b>. <i>Аналогично <b>OPTFIELD</b>, с тем отличием, что отображается
поле ввода длиной 20 символов.</i>

<p>
<dd><b>OPT2FIELD</b>. <i>Вызов:</i> <font face=courier size=-1><b>optfield('PARAMETER1',$title1,'PARAMETER2',$title2,$desc,$length1,$length2)</b></font>.
<dd><i>Ключи:</i> <b>PARAMETER1</b> &#151; наименование ключа хеша %inis, сопоставленного с первым параметром;
<dd><b>$title1</b> &#151; название первого параметра;
<dd><b>PARAMETER2</b> &#151; наименование ключа хеша %inis, сопоставленного со вторым параметром;
<dd><b>$title2</b> &#151; название второго параметра;
<dd><b>$desc</b> &#151; описание (комментарий);
<dd><b>$length1</b> &#151; длина поля для первого параметра;
<dd><b>$length12</b> &#151; длина поля для второго параметра.
<dd><i>Описание.</i> Подпрограмма вывода элемента формы администрирования для
определения значений двух строковых параметров. Ширина поля задается для
каждого параметра отдельно. Необходимо предварительное задание тега формы
и тега таблицы с шестью столбцами.

<p>
<dd><b>OPTSELECT</b>. <i>Вызов:</i> <font face=courier size=-1><b>optselect('PARAMETER',$title,$desc,$nvalues,$values,$descs)</b></font>.
<dd><i>Ключи:</i> <b>PARAMETER</b> &#151; наименование ключа хеша %inis, сопоставленного с параметром;
<dd><b>$title</b> &#151; название параметра;
<dd><b>$desc</b> &#151; описание (комментарий);
<dd><b>$nvalues</b> &#151; число элементов в списке;
<dd><b>$values</b> &#151; значения элементов;
<dd><b>$descs</b> &#151; описания (названия) элементов.
<dd><i>Описание.</i> Подпрограмма вывода элемента формы администрирования для
определения значения параметра, позволяющего выбор из некоторого количества
возможных. Представляется в виде выпадающего списка с активным текущим
значением. Значения и описания элементов можно задавать массивами.
Необходимо предварительное задание тега формы и тега таблицы с шестью столбцами.


<p>
<dd><b>OPTSUBMIT</b>. <i>Вызов:</i> <font face=courier size=-1><b>optsubmit($login,$password,$oper,$fid,$stringsubmit)</b></font>.
<dd><i>Ключи:</i> <b>$login</b> &#151; имя входа администратора;
<dd><b>$password</b> &#151; пароль администратора;
<dd><b>$oper</b> &#151; предстоящая операция (обычно submit);
<dd><b>$fid</b> &#151; идентификатор форума;
<dd><b>$stringsubmit</b> &#151; отображаемое на кнопке сообщение.
<dd><i>Описание.</i> Предписание отобразить кнопку отправления заполненной формы.
Кроме того, указывает определенное число скрытых параметров, интерпретируемых
в дальнейшем программой, содержащих параметры входа администратора.
Необходимо предварительное задание тега формы.

<p>
<dd><b>SHOWNEWS</b>. <i>Вызов:</i> <font face=courier size=-1><b>&shownews</b></font>.
<dd><i>Описание.</i> Подпрограмма вывода новостей и извещений о появлении новых
сообщений и ответов. Результат отработки процедуры зависит от глобальных
установок форума, а также индивидуальных настроек пользователей. Глобальная
переменная $newstype определяет характер выводимой информации:
<dd><li>при $newstype=1 выводятся только новостные строки;</li>
<dd><li>при $newstype=2 выводятся только уведомления;</li>
<dd><li>при $newstype=3 выводятся и новостные строки, и уведомления.</li>
<dd>По умолчанию $newstype=3.


<p>
<dd><b>VERIFYUSER</b>. <i>Вызов:</i> <font face=courier size=-1><b>$ret=verifyuser($title,$notaccess)</b></font>.
<dd><i>Ключи:</i> <b>$title</b> &#151; строка, выводимая в заголовок html, соответствует второму значению в строке в файле &lt;wtbaccess.txt&gt;;
<dd><b>$notaccess</b> &#151; объяснение отказа в доступе, соответствует третьему значению в строке в файле &lt;wtbaccess.txt&gt;.
<dd><i>Описание.</i> Подпрограмма проверки доступа пользователя с одного из
запрещенных IP-адресов или с указанным в списке игнорирования cookie.
Возвращает <b>-1</b> при установке мониторинга, <b>-2</b> при предписании
полностью не допускать пользователя. Иначе <b>0</b>.


<p>
<dd><b>UPDATEUSER</b>. <i>Вызов:</i> <font face=courier size=-1><b>&updateuser</b></font>.
<dd><i>Описание.</i> Производится обновление пользовательской записи в базе
данных форума. Обновляются код времени, адрес электронной почты, IP-адрес и
список параметров настройки. Имя, код имени и пароль не затрагиваются.
При нулевой длине кода имени подпрограмма обновление не выполняется.
Возвращаемых значений нет.


<p>
<dd><b>FILESTP</b>. <i>Вызов:</i> <font face=courier size=-1><b>filestp($file)</b></font> или <font face=courier size=-1><b>$ret=filestp($file)</b></font>.
<dd><i>Ключи:</i> <b>$file</b> &#151; путь к файлу сообщения.
<dd><i>Описание.</i> Производится разбор указанного файла и запись
отождествленных значений в массив @stp согласно приведенной ниже таблице. Если
указанное в $file сообщение не существует, возвращается <b>-1</b>.


<p>
<dd><b>DELETEMES</b>. <i>Вызов:</i> <font face=courier size=-1><b>deletemes($delref,'on/off')</b></font>.
<dd><i>Ключи:</i> <b>$delref</b> &#151; номер удаляемого сообщения,
без расширения;
<dd><b>on/off</b> &#151; предписывает удалять или не удалять файл.
<dd><i>Описание.</i> Подпрограмма удаляет сообщение с указанным номером
и все подчиненные ему, правит файлы вышестоящих сообщений, индекс и структуру.
<dd>При значении второго
параметра <b>on</b> ссылка на сообщение удаляется из всех
вышестоящих сообщений, из основной страницы, после чего удаляется файл. Если
второй параметр принимает значение <b>off</b> либо не определен, удаляется только
ссылка на файл с основной страницы и из структуры. Восстановление форума
с потерей структуры восстановит ссылку на сообщение.
<dd><b><i>ВНИМАНИЕ!</i></b> Возможна некорректная работа данной подпрограммы,
поэтому не забывайте проверить основную страницу форума после удаления сообщения.


<!--<p>
<dd><b></b>. <i>Вызов:</i> <font face=courier size=-1><b></b></font>.
<dd><i>Ключи:</i> <b></b> &#151; ;
<dd><b></b> &#151; ;
<dd><i>Описание.</i>-->



<br><br><br><p><center><h3><a name=4></a>4. Общие переменные</h3></center>

<dd>Полный список доступных для использования переменных скрипта,
определяемых при запуске params, можно получить посредством скрипта
wtbdev.cgi.
<dd>Ниже даны комментарии к некоторым переменным.
<p><dd><i>Версия.</i>
<dd><b>$version</b> &#151; символьное обозначение версии;
<dd><b>$internalversion</b> &#151; численное обозначение версии. Рекомендуется,
чтобы модуль проверял версию программы перед выполнением. Во всех ранних (до
2.451b) выпусках WTBoard эти две переменные не определены. В дальнейших версиях
значение будет увеличиваться.
<p><dd><i>Время.</i>
<dd><b>$curtime</b> &#151; время вызова скрипта, преобразованное из значений
массива @t согласно формуле
second+(minute+(hour+(day+(month+year*12)*31)*24)*60)*60. Все внутренние
временные интервалы скрипта имеют подобное представление.
<dd><b>$utimes</b> &#151; код времени, соответствующий последнему посещению
участником форума (обновляется в базе посредством подпрограммы UPDATEUSER).
<dd><b>@t</b> &#151; временной массив текущего момента. Расклад следующий: [0]
секунды, [1] минуты, [2] часы, [3] дни, [4] месяцы, [5] годы. Значение месяца
($t[4]) всегда на единицу меньше реального, это необходимо учитывать при
подстановке. Год приводится в состояние полного летоисчисления.
<p><dd><i>Администрирование.</i>
<dd><b>$login</b> &#151; входное имя администратора;
<dd><b>$pass</b> &#151; пароль администратора;
<dd><b>$stat</b> &#151; права доступа администратора.
<p><dd><i>Пользователи.</i>
<dd><b>$utimes</b> &#151; см. выше.
<dd>
<p><dd><i>Строки.</i>
<dd><b>@stp</b> &#151; массив значений, полученных в результате синтаксического
анализа строки индекса и сопоставляемых ключам в параметре string при генерации
строки индекса. Сопоставляется по идентификаторам с массивом <b>@tag</b>.
При вызове подпрограммы filestp массив @stp определяется исходя из содержания
соответствующего файла. В таблице показаны значения ключей, их соответствие
массиву @tag и заполнение при вызове соответствующих программ. Обозначения:
&#171;+&#187; &#151; заполняется в обязательном порядке, &#171;*&#187; &#151;
заполняется при наличии соответственного ключа в параметре <b>string</b>,
&#171;-&#187; &#151; не заполняется, &#171;?&#187; &#151; может быть
не определено.
<p>
<table width=100% border=1>
<tr><td align=center><b></b></td><td align=center><b>Описание</b></td><td align=center><b>Соответстующий<br>ключ в @tag</b></td><td><b>string</b></td><td><b>filestp</b></td></tr>
<tr><td>0</td><td>Путь к сообщению через браузер (dirkonf/file.ext)</td><td>$href</td><td>*</td><td>+</td></tr>
<tr><td>1</td><td>Тема сообщения</td><td>$subj</td><td>*</td><td>+</td></tr>
<tr><td>2</td><td>Имя автора</td><td>$name</td><td>*</td><td>+</td></tr>
<tr><td>3</td><td>Имя автора, заключенное в ссылку на адрес e-mail</td><td>$nemail</td><td>?</td><td>?</td></tr>
<tr><td>4</td><td>Час генерации формы</td><td>$fhour</td><td>*</td><td>+</td></tr>
<tr><td>5</td><td>Час приема сообщения на сервере</td><td>$shour</td><td>+</td><td>+</td></tr>
<tr><td>6</td><td>Минута генерации формы</td><td>$fmin</td><td>*</td><td>+</td></tr>
<tr><td>7</td><td>Минута приема сообщения на сервере</td><td>$smin</td><td>+</td><td>+</td></tr>
<tr><td>8</td><td>Секунда генерации формы</td><td>$fsec</td><td>*</td><td>+</td></tr>
<tr><td>9</td><td>Секунда приема сообщения на сервере</td><td>$ssec</td><td>+</td><td>+</td></tr>
<tr><td>10</td><td>День недели генерации формы (слово)</td><td>$fweek</td><td>*</td><td>+</td></tr>
<tr><td>11</td><td>День недели приема сообщения на сервере (слово)</td><td>$sweek</td><td>+</td><td>+</td></tr>
<tr><td>12</td><td>Число генерации формы</td><td>$fday</td><td>*</td><td>+</td></tr>
<tr><td>13</td><td>Число приема сообщения на сервере</td><td>$sday</td><td>+</td><td>+</td></tr>
<tr><td>14</td><td>Месяц генерации формы</td><td>$fmonth</td><td>*</td><td>+</td></tr>
<tr><td>15</td><td>Месяц приема сообщения на сервере</td><td>$smonth</td><td>+</td><td>+</td></tr>
<tr><td>16</td><td>Месяц генерации формы (название)</td><td>$fwmonth</td><td>*</td><td>+</td></tr>
<tr><td>17</td><td>Месяц приема сообщения на сервере (название)</td><td>$swmonth</td><td>+</td><td>+</td></tr>
<tr><td>18</td><td>Двухсимвольное обозначение года</td><td>$year</td><td>+</td><td>+</td></tr>
<tr><td>19</td><td>Четырехсимвольное обозначение года</td><td>$fullyear</td><td>+</td><td>+</td></tr>
<tr><td>20</td><td>Количество ответов на сообщение</td><td>$answers</td><td>+</td><td>+</td></tr>
<tr><td>21</td><td>Метка новизны сообщения (если сообщение было помечено как новое)</td><td>$new</td><td>?</td><td>-</td></tr>
<tr><td>22</td><td>Размер сообщения</td><td>$length</td><td>*</td><td>+</td></tr>
<tr><td>23</td><td>Время создания сообщения, приведенное в соответствие с внутренним форматом времени скрипта</td><td>$fxdata</td><td>+</td><td>+</td></tr>
<tr><td>24</td><td>Содержимое сообщения (форматированный текст)</td><td>$fxbody</td><td>*</td><td>+</td></tr>
<tr><td>25</td><td>Ссылка URL в сообщении</td><td>$fxurl</td><td>?</td><td>?</td></tr>
<tr><td>26</td><td>Название ссылки URL в сообщении</td><td>$fxturl</td><td>?</td><td>?</td></tr>
<tr><td>27</td><td>Ссылка на картинку в сообщении</td><td>$fximg</td><td>?</td><td>?</td></tr>
<tr><td>28</td><td>Имя файла сообщения, на которое текущее является ответом</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>29</td><td>Тема сообщения, на которое текущее является ответом</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>30</td><td>Имя автора сообщения, на которое текущее является ответом</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>31</td><td>Имя и адрес автора сообщения, на которое текущее является ответом</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>32</td><td>Час создания сообщения, на которое текущее является ответом</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>33</td><td>Минута создания сообщения, на которое текущее является ответом</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>34</td><td>Секунда создания сообщения, на которое текущее является ответом</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>35</td><td>Число создания сообщения, на которое текущее является ответом</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>36</td><td>Месяц создания сообщения, на которое текущее является ответом</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>37</td><td>Год создания сообщения, на которое текущее является ответом</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>38</td><td>Номер сообщения</td><td>$number</td><td>+</td><td>+</td></tr>
<tr><td>39</td><td>Дерево ответов на сообщение в формате структуры</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>40</td><td>Список номеров вышестоящих сообщений, разделенных символом ;</td><td>нет</td><td>-</td><td>?</td></tr>
<tr><td>41</td><td>Название файла сообщения</td><td>$fxfile</td><td>+</td><td>+</td></tr>
<tr><td>42</td><td>Физический путь к файлу сообщения (dirrealkonf/file.ext)</td><td>нет</td><td>+</td><td>+</td></tr>
</table>

<font face="Arial, Times New Roman" size=2>

<p>&nbsp;<p>
<hr size=2 width=80% align=center>

<br><br><br><p><center><h3><a name=app></a>Приложения</h3></center>

<p><center><h3><a name=app1></a>1. Форматы HTML-файлов форума</h3></center>
<dd>Работа скриптов отчасти основана на строго определенном формате динамических
и генерируемых html-файлов форума &#151; это файл основной страницы (index.shtml)
и файлы, содержащие сообщения.
<dd>Поскольку при отработке некоторых процедур скрипты берут определенные
строки файлов, не верифицируя их, неверный формат может пагубно отразиться на
функционировании форума. Если ваш plug-in предусматривает перезапись динамических
файлов, то он должен придерживаться изложенных ниже форматов.
<p><b>Основная страница (по умолчанию index.shtml)</b>
<dd><pre><b><font face=courier>--------------------------------------
{begindex}
&lt;ul&gt;
&lt;!--home--&gt;
&lt;!--XXX--&gt;&lt;li&gt;{string}
&lt;ul&gt;&lt;!--XXX--&gt;&lt;li&gt;{string}
&lt;/ul&gt;
&lt;ul&gt;&lt;!--XXX--&gt;&lt;li&gt;{string}
&lt;ul&gt;&lt;!--XXX--&gt;&lt;li&gt;{string}
&lt;/ul&gt;
&lt;/ul&gt;
{endindex}
--------------------------------------</font></b></pre>
<dd>Соответственно ключевым словам, помещенным в фигурные скобки, подставляются
интерполированные параметры, определенные в конфигурации форума. XXX &#151;
число, идентичное номеру сообщения, которое соответствует данной строке.
Строка индекса занимает одну или две строки кода. В случае, если это
корневое сообщение, оно определяется одной строкой. Подчиненное сообщение
(ответ) структуризуется признаком списка (&lt;ul&gt;) в начале строки, по
которому его можно идентифицировать. Следующей (второй) строкой идет закрытие
списка, в результате чего список выравнивается. Первоначально обе строки ответа
располагаются подряд. В дальнейшем их может разделять до нескольких десятков и
даже сотен строк подчиненных сообщений. В результате рендеринга такого
html-кода получается довольно логичное дерево сообщений и ответов на них.

<p><b>Корневое сообщение (номер XXX)</b>
<dd><pre><b><font face=courier>--------------------------------------
{begmes}
<!--endhome-->
Отправлено &lt;b&gt;&lt;a href="mailto:{email}"&gt;{realn}&lt;/a&gt;&lt;/b&gt; &lt;i&gt;{hh}:{mm}:{ss} {dd}/{mm}/{yyyy}&lt;/i&gt;:&lt;p&gt;&lt;div align=justify&gt;
&lt;dd&gt;
{body}
&lt;p&gt;{separator}
&lt;p&gt;&lt;!--{prev}/{time}/{weekday}/{length}--&gt;&lt;a name=ans&gt;Ответы и комментарии:&lt;/a&gt;&lt;p&gt;
&lt;/div&gt;&lt;div align=left&gt;
&lt;ul&gt;
&lt;!--home--&gt;
&lt;!--XXX--&gt;
&lt;!--end--&gt;
&lt;/ul&gt;
&lt;!--homeend--&gt;
{endmes}
--------------------------------------</font></b></pre>
<dd>Если адрес электронной почты не определен, то ссылка не ставится.
<dd>Формат даты в сообщении строго фиксирован. В дальнейшем он используется
при восстановлениях основной страницы.
<dd>Фрагменты &#171;Отправлено &lt;b&gt;&#187; и &#171;Ответы и комментарии:&#187;
соответствуют пятнадцатой и восемнадцатой строкам из файла ресурсов
(&lt;wtblang.txt&gt;). При наличии файла ресурсов для
другого языка строки, разумеется, будут иными.
<dd>Скрытыми параметрами сообщения являются следующие технические ключи,
используемые скриптом для получения о сообщении дополнительной информации:
<ul><li><b>{prev}</b> &#151; список номеров вышестоящих сообщений, разделенных
символом &#171;;&#187;;
<li><b>{time}</b> &#151; дата и время создания сообщения на сервере во внутреннем
формате времени скрипта;
<li><b>{weekday}</b> &#151; номер дня недели, в который сообщение было создано;
<li><b>{length}</b> &#151; длина полезной части посылаемого сообщения, за
исключением цитируемого текста и шаблонов.
</ul>
<dd>Фрагмент после &lt;!--XXX--&gt; предназначен для регистрации ответов
на данное сообщение.

<p><b>Ответное сообщение (номер XXX)</b>
<dd><pre><b><font face=courier>--------------------------------------
{begmes}
<!--endhome-->
Отправлено &lt;b&gt;&lt;a href="mailto:{email}">{realn}&lt;/a&gt;&lt;/b&gt; &lt;i&gt;{hh}:{mm}:{ss} {dd}/{mm}/{yyyy}&lt;/i&gt;
&lt;div align=left&gt;в ответ на: &lt;a href={prevXXX}&gt;{prevsubj}&lt;/a&gt;, отправлено &lt;b&gt;&lt;a href="mailto:{prevemail}"&gt;{prevrealn}&lt;/a&gt;&lt;/b&gt; &lt;i&gt;{hh}:{mm}:{ss} {dd}/{mm}/{yyyy}&lt;/i&gt;:&lt;p&gt;&lt;div align=justify&gt;
&lt;dd&gt;
{body}
&lt;p&gt;{separator}
&lt;p&gt;&lt;!--{prev}/{time}/{weekday}/{length}--&gt;&lt;a name=ans&gt;Ответы и комментарии:&lt;/a&gt;&lt;p&gt;
&lt;/div&gt;&lt;div align=left&gt;
&lt;ul&gt;
&lt;!--home--&gt;
&lt;!--XXX--&gt;
&lt;!--end--&gt;
&lt;/ul&gt;
&lt;!--homeend--&gt;
{endmes}
--------------------------------------</font></b></pre>
<dd>Все замечания относительно корневого сообщения справедливы. Кроме того,
фрагменты &#171;в ответ на: &#187; и &#171;отправлено &lt;b&gt;&#187; соответствуют
шестнадцатой и девятнадцатой строкам файла ресурсов.




<br><br><br><p><center><h3><a name=app2></a>2. Форматы конфигурационных файлов</h3></center>
<dd>Формат конфигурационных файлов имеет важное значение для исправной
работы форума, что уже неоднократно было подтверждено за годы работы.
Небольшие, но некорректные изменения могут вообще привести к краху форума. Его
достаточно легко восстановить, однако это все равно неприятно. Поэтому
необходимо как можно более тщательно проверять вносимые изменения. Или изменять
только совсем уж очевидные вещи.
<dd>Программа выполнена с упором на максимально простой способ изменения вида
форума. От версии к версии код отлаживается и вычищается, расширяются
возможности конфигурирования, совершенствуется синтаксис генерируемого
HTML-кода. В этом немаловажная роль принадлежит конфигурационным
файлам.

<p><dd><b>wtbaccess.txt</b>
<dd>Начиная с версии 2.933b файл не несет смысловой нагрузки в связи с
перенесением его функций в базу участников <b>wtbnames.txt.*</b> и оставлен
для обеспечения совместимости.

<p><dd><b>wtbadmin.txt</b>
<dd>Список администраторов и права их доступа к административной секции. Состоит
из некоторого количества строк, каждая из которых определяет одного администратора.
Значения в строке разделяются двойным знаком &#171;точка с запятой&#187; &#151; <b>;;</b>, строка
заканчивается таким же знаком. Первое значение &#151; имя администратора, второе
&#151; его пароль. Третье значение &#151; список прав доступа (полное описание
стандартных ключей доступа см. на административной странице). Вы можете назначить
вашему плагину дополнительный ключ разрешения администрации, либо использовать
уже существующие. Список прав доступа возвращается подпрограммой VERIFYADMIN.

<p><dd><b>wtbini.txt</b>
<dd>Файл, содержащий названия конфигурационных файлов форума. Состоит
из некоторого количества строк, каждая из которых определяет названия файлов
для одного форума. Значения в строке разделяются знаком &#171;точка с запятой&#187;
&#151; <b>;</b>, строка заканчивается таким же знаком. Первое значение в списке
&#151; идентификатор форума (соответствует в прочих местах ключу $fid). Их число
не ограничено. Рекомендуется применять численный идентификатор, хотя это
несущественно. Указание идентификатора, совпадающего с какими-то иными
ключами программы, передающимися посредством браузера, может привести к
непредсказуемым последствиям. При отсутствии идентификатора используется
значение 0.
<dd>Второе, третье, четвертое и т. д. значения определяют названия конфигурационных
файлов форума в соедующей последовательности:
<center><b><font face=courier>wtbaccess.txt, wtbadmin.txt, wtblang.txt, wtblast.txt, wtbnames.txt,<br>
wtbnews.txt, wtboard.txt, wtbreplace.txt, wtbstruct.txt, wtwrong.txt</font></b></center>

<p><dd><b>wtblang.txt</b>
<dd>Языковой модуль программы. Большинство текстовых конструкций, используемых
при работе, берутся из него. Исключение составляют только те значения, что
определены в файлах wtboard.txt и wtbaccess.txt. Состоит из некоторого количества
строчек, которые при запуске программы считываются в массив @lng. В нужных
местах выводятся соответствующие элементы массива.
<dd>Строки 301-400 зарезервированы для контекстных подсказок.

<p><dd><b>wtblast.txt</b>
<dd>Файл, определяющий нумерацию сообщений. Содержит два значения. Первое (без
идентификатора)
соответствует номеру последнего сгенерированного файла. При генерации сообщения
это значение считывается, проверяется на соответствие, после чего увеличивается
на единицу и записывается в файл поверх старого.
<dd>Второе значение идентифицируется ключом <b>arc</b> и соответствует дате последней проверки форума
на достижение критериев автоархивации. Обычно обновляется раз в сутки.
<a name=wtbnames></a>

<p><dd><b>wtbnames.txt.*</b>
<dd>Файл в формате базы данных SDBM, содержащий информацию об участниках форума
в следующих ключах:
<dd><font face=courier size=-1><b>id_NAME</b></font> &#151; идентификатор
пользователя, получаемый модификацией имени (name) с целью устранения наличия
букв, имеющих сходное написание, но разный смысл. Все такие буквы приводятся
к общему виду, что позволяет избежать появление разных пользователей под одним
и тем же ником (различающимся, скажем, буквой Р &#151; &#171;эр&#187; в русском
и &#171;пэ&#187; в латинском вариантах), а следовательно и недоразумений,
связанных с этим. NAME представляет собой эту же комбинацию символов, то есть
key(id_NAME)=value(NAME); (преобразуется также в переменную $names для
совместимости с предыдущими версиями и большего удобства);
<dd><font face=courier size=-1><b>w_NAME</b></font> &#151; пароль
пользователя, позволяющий пользоваться зарегистрированным
именем только ему (переменная $pass);
<dd><font face=courier size=-1><b>m_NAME</b></font> &#151; адрес e-mail (переменная $mails);
<dd><font face=courier size=-1><b>n_NAME</b></font> &#151; реальное 
имя (или ник) пользователя. Отображается в сообщениях и на основной
странице (переменная $realn);
<dd><font face=courier size=-1><b>h_NAME</b></font> &#151; последний IP-адрес
пользователя. При генерации какого-либо сообщения
от этого пользователя его IP-адрес обновляется (переменная $ipaddr);
<dd><font face=courier size=-1><b>u_NAME</b></font> &#151; 
индивидуальные настройки пользователя. Представляет собой строку
символов, каждый из которых определяет наличие или отсутствие определенной
настройки. Может быть нулевой длины (по умолчанию). Большинство параметров
объявляются запрещенными, если соответствующий им ключ присутствует в строке.
Хотя есть и исключения. Значение помечается также идентификатором форума на
тот случай, если несколько параллельных форумов будут использовать одну общую
базу участников (переменная $pars);
<dd><font face=courier size=-1><b>t_FID_NAME</b></font> &#151; 
код времени последнего посещения зарегистрированным
пользователем форума. Обновляется каждый раз при считывании им основной
страницы (при условии работы новостной строки). Обновление производится вызовом
подпрограммы UPDATEUSER. Значение помечается также идентификатором форума на
тот случай, если несколько параллельных форумов будут использовать одну общую
базу участников (переменная $utime);
<dd><font face=courier size=-1><b>i_NAME</b></font> &#151; ключ игнорирования, 
&#171;-&#187;, если участник находится в режиме read-only; &#171;!&#187;,
если участник находится в режиме полного запрета доступа, или ничего, если
ограничений нет;
<dd><font face=courier size=-1><b>it_NAME</b></font> &#151; при игнорировании
участника содержит строку заголовка выдаваемого предупреждения;
<dd><font face=courier size=-1><b>ib_NAME</b></font> &#151; при игнорировании
участника содержит содержимое выдаваемого предупреждения.
<dd>Кроме того, используются следующие ключи:
<dd><font face=courier size=-1><b>ignor_ip</b></font> &#151; список IP-адресов,
находящихся в режиме read-only;
<dd><font face=courier size=-1><b>stop_ip</b></font> &#151; список IP-адресов,
находящихся в режиме полного запрета доступа;

<dd>База участников wtbnames.txt.* хранится в формате базы данных SDBM и
представляет собой пару файлов &#151; wtbnames.txt.dir и wtbnames.txt.pag.
Это позволяет плагину определить какие-то дополнительные ключи для каждого
конкретного пользователя, используя идентификатор NAME. Однако следует иметь
в виду, что общая длина пары <i>ключ&#151;значение</i> не должна превышать 1000
символов. Это ограничение налагается форматом базы данных.
<dd>База участников открывается при инициализации форума в хеш <b>%wtbuser</b>
и остается открытой до конца отработки скрипта. Любое изменение значения
хеша немедленно отражается в базе, поэтому при работе непосредственно с
базой рекомендуется использовать временные промежуточные переменные.
<dd>Любые операции, связанные с редактированием данных участников, рекомендуется
проводить с помощью административного скрипта.

<p><dd><b>wtbnews.txt</b>
<dd>Файл, содержащий новостные строки. Формат файла:
<center><b>yearb;;monthb;;dayb;;hourb;;minb;;yeare;;monthe;;daye;;houre;;mine;;message;;</b></center>
<dd>Переменные *b соответствуют времени, определяющему начало демонстрации
новостной строки, переменные *e определяют последний срок. Даты записываются
в формате, понятном пользователю. Значение message
состоит обычно не только из самого сообщения, но также из частей HTML-кода, 
форматирующих его отображение в браузере.

<p><dd><b>wtboard.txt</b>
<dd>Файл основных настроек форума. Важнейший элемент программы, неверные
параметры, указанные в нем, могут привести к неисправностям в работе.
<dd>Файл состоит из нескольких секций:
<dd><li>[Board Options] &#151; общие параметры.
<dd><li>[Service Options] &#151; некоторые опции сервисных функций.
<dd><li>[Form Options] &#151; значения, определяющие размеры полей в формах ввода
сообщений.
<dd><li>[Board Colors] &#151; значения цветов форума.
<dd><li>[Board Strings] &#151; шаблоны HTML-контента форума.
<dd><li>[Archives Section] &#151; раздел для записи названий каталогов архивов.
<dd><li>[Plugin Options] &#151; раздел для хранения параметров дополнительных
модулей.
<dd>Добавление и изменение значений параметров производится подпрограммой
SAVEVALUE.
<dd>При инициализации подпрограммой PARAMS производится считывание файла и
создание хешей %inip (содержащего все параметры форума, кроме секции [Board Strings])
и %patp (содержащего шаблоны из секции [Board Strings]), затем соответствующих
переменных (для совместимости с предыдущими версиями), содержащих те же
значения. Вызов params(2) создает также хеш %inis, содержащий все параметры
форума в неинтерполированном виде, что необходимо при администрировании.


<p><dd><b>wtbreplace.txt</b> &#151; файл со списком контекстной замены.
<dd>В файле &lt;wtbreplace.txt&gt; определяется список контекстной замены.
Используется следующий формат строк:
<DD><b>xxx;;yyy</b>
<br>или
<DD><b>KKxxx;;yyy</b>
<br>где <b>KK</b> &#151; управляющие символы замены (не более трех), <b>xxx</b>
&#151; строка, подлежащая замене, <b>yyy</b> &#151; заменяющая строка.
<dd>Управление заменой производится с помощью нескольких специальных символов:
<u><b><font face="Courier"># @ * ; % ! &lt; &gt; \</font></b></u>.
Их предназначение в следующем:
<dd><b>#</b> &nbsp; предписывает производить замену только в заголовке (теме)
сообщений;
<dd><b><font face="Courier">@</font></b> &nbsp; предписывает производить замену
только в теле сообщения;
<dd><b><font face="Courier">*</font></b> &nbsp; предписывает производить замену
и в теле сообщения, и в заголовке (значение по умолчанию, подразумевается при
отсутствии всяких ключей);
<dd><b><font face="Courier">;</font></b> &nbsp; строка комментария;
<dd><b><font face="Courier">%</font></b> &nbsp; рекомендует рассматривать
шаблон поиска как регулярное выражение, по умолчанию отключен;
<dd><b><font face="Courier">!</font></b> &nbsp; позволяет участнику форума
отключить данный элемент контекстной замены для своих сообщений;
<dd><b><font face="Courier">&lt;</font></b> &nbsp; предписывает производить
замену только при генерации формы ответа в цитируемом тексте;
<dd><b><font face="Courier">&gt;</font></b> &nbsp; предписывает производить замену только при приеме сообщения
на сервере;
<dd><b><font face="Courier">\</font></b> &nbsp; применим в первой позиции в том
случае, если нужно заменять фрагмент, содержащий один из перечисленных
спецсимволов.
<dd>Управляющих символов может быть не более пяти, например: <b><font
face="Courier">#%&gt;XXX;;YYY</font></b> &#151; производить замену XXX на YYY
только в заголовках только при приеме сообщения на сервере, рассматривая XXX
как регулярное выражение; <b><font face="Courier">\*ONE;;+TWO</font></b> &#151;
всегда заменять *ONE на +TWO. При этом символы #, @ и *, если они есть, должны
быть в начале, % следует после них, направление замены &lt; и &gt; указывается
в последнюю очередь.


<p><dd><b>wtbstruct.txt</b> &#151; файл со структурой сообщений форума.
<p><dd><b>wtwrong.txt</b> &#151; файл для записи критических событий форума.


<br><br><br><p><center><h3><a name=app3></a>5. Сценарий администратора</h3></center>

<dd>Для более удобного редактирования конфигурации подключаемых модулей
рекомендуется применять доступные в wtbext.cgi подпрограммы. Подробнее
детали создания формы описаны выше. Кроме того, WTBoard с версии 2.933b
поддерживает сценарий администратора &#151; фрагмент кода скрипта модуля,
рассматриваемый перлом как комментарий, но понимаемый административной частью
программы как определенные директивы. Рекомендуется использовать эту
возможность, чтобы облегчить администратору вызов режима администрирования
скрипта.
<dd>В общем виде сценарий выглядит следующим образом:
<font face=courier size=-1><b>
<dd># admin.section begin
<dd># admin.requireversion={internalversion}
<dd># admin.skip={module_parameter}
<dd># admin.name={Module Name}
<dd># admin.version={version}
<dd># admin.description={Description}
<dd># admin.administrator={login}
<dd># admin.password={password}
<dd># admin.operation={operation}
<dd># admin.section end
</b></font>
<dd>Порядок и синтаксис строк должен быть именно в таком порядке. 
Необязательный параметр &#151; <b># admin.skip={module_parameter}</b>,
его наличие предписывает пропустить дальнейшие строки секции. В качестве
&#171;module_parameter&#187; используется название любого параметра,
если значение параметра определено, то секция пропускается. Это хорошо
использовать для определения того факта, был уже установлен данный модуль
или нет.
<dd>Команды подразумевают следующее:
<dd>admin.section begin &#151; носит чисто комментарный характер;
<dd>admin.requireversion &#151; сравнивает указанное значение с внутренней
переменной скрипта $internalversion, если последняя меньше, то секция
пропускается;
<dd>admin.skip &#151; рассмотрен чуть выше;
<dd>admin.name &#151; название модуля;
<dd>admin.version &#151; версия модуля;
<dd>admin.description &#151; описание действия модуля в этой секции;
<dd>admin.administrator &#151; название <b>ключа</b>, который модуль использует
для авторизации администратора при входе в конфигурацию; это <b>не</b> само имя
администратора;
<dd>admin.password &#151; название <b>пароля</b>, который модуль проверяет
при авторизации; это <b>не</b> сам пароль;
<dd>admin.operation &#151; название операции, которую предусматривает данная
секция;
<dd>admin.section end &#151; конец сценария, при обнаружении этой команды
скрипт прекращает сканирование файла.
<dd>Если модуль предусматривает несколько режимов администрации, их следует
располагать друг за другом, соблюдая порядок команд.
<dd>Идентификатор форума, имя и пароль администратора подставляются
автоматически соответственно введенным при входе в администрацию, поэтому
команды admin.administrator и admin.password подразумевают названия ключей.
<dd>Ниже приведен пример сценария, позволяющего включить в форму
администрирования коды, выполняющие вызовы, аналогичные следующему:
<center><font face=courier size=-1><b>
http://www.host.com/cgi-bin/wtbcitate.cgi?fid=0&administrator=LOGIN&pass=PASS
</center></b></font>
и следующему
<center><font face=courier size=-1><b>
http://www.host.com/cgi-bin/wtbcitate.cgi?fid=0&administrator=LOGIN&pass=PASS&oper=setup
</center></b></font>
<dd>Пример сценария:
<table border=0>
<tr><td><font face=courier size=-1><b># admin.section begin</b></font></td><td>; начало</td></tr>
<tr><td><font face=courier size=-1><b># admin.requireversion={2933}</b></font></td><td>; минимально требуемая версия</td></tr>
<tr><td><font face=courier size=-1><b># admin.skip={citate_file}</b></font></td><td>; если в wtboard.txt определен параметр citate_file, перейти к NEXT</td></tr>
<tr><td><font face=courier size=-1><b># admin.name={White Tiger Citate}</b></font></td><td>; название модуля</td></tr>
<tr><td><font face=courier size=-1><b># admin.version={1.21a}</b></font></td><td>; версия модуля</td></tr>
<tr><td><font face=courier size=-1><b># admin.description={Установка модуля цитат}</b></font></td><td>; описание режима</td></tr>
<tr><td><font face=courier size=-1><b># admin.administrator={administrator}</b></font></td><td>; название ключа имени</td></tr>
<tr><td><font face=courier size=-1><b># admin.password={pass}</b></font></td><td>; название ключа пароля</td></tr>
<tr><td><font face=courier size=-1><b># admin.operation={setup}</b></font></td><td>; название режима</td></tr>
<tr><td><font face=courier size=-1><b># admin.requireversion={2933}</b></font></td><td>; NEXT, следующая секция, переходит сюда</td></tr>
<tr><td><font face=courier size=-1><b># admin.name={White Tiger Citate}</b></font></td><td>; название модуля</td></tr>
<tr><td><font face=courier size=-1><b># admin.version={1.21a}</b></font></td><td>; версия модуля</td></tr>
<tr><td><font face=courier size=-1><b># admin.description={Настройка модуля цитат}</b></font></td><td>; название режима</td></tr>
<tr><td><font face=courier size=-1><b># admin.administrator={administrator}</b></font></td><td>; название ключа имени</td></tr>
<tr><td><font face=courier size=-1><b># admin.password={pass}</b></font></td><td>; название ключа пароля</td></tr>
<tr><td><font face=courier size=-1><b># admin.operation={}</b></font></td><td>; название операции, ставится как значение ключа oper (может быть пустым!)</td></tr>
<tr><td><font face=courier size=-1><b># admin.section end</b></font></td><td>; конец сценария</td></tr>
</table>

<font face="Arial, Times New Roman" size=2>

<CENTER><P><hr size=1 width=80% align=center><P>
<P><B><TT><A HREF="wtboard.htm">назад</A></TT></B></P>
<P><hr size=1 width=80% align=center><P></center>
<P><div align=left><FONT SIZE="-2"><B><I>
Файл создан 28 октября 1999 года. Последний раз дополнялся 25 июня 2000 года.<br>
Copyright &#169; 1998-2000, <A HREF="mailto:wtiger@mail.ru">White Tiger</a>.
</BODY>
</HTML>
