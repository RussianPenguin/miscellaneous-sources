<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
<style type="text/css">
A.black:link {COLOR: #000000; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
A.black:visited {COLOR: #000000; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
A.black:hover {COLOR: #FFFFFF; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
.b {text-decoration: none; color:#FF0000;} 
.b:hover {color:#7785FF;}
.c {text-decoration: none; color:#000000;} 
.c:hover {color:#FFFFFF;}
 pre {color: blue;}
TD.colon {COLOR: #000000; FONT-FAMILY: "MS Sans Serif", sans-serif; FONT-SIZE: 9pt}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta content="программирование на Visual Basic, документация, документы, delphi, pascal, cpp, hardware, web, веб-мастер, советы, описания, доки, manual, Java, C, C++, обучение, исходники, odbc, jdbc, programm, protocols, протоколы, общение, форумapplet, java, design, апплет, дизайн, ява, Free, counters, Trackers, Guestbooks, Access Logs, Banners, Graphics, Banner ads, Fonts, Form Mailer, form mailers, graphics, icons, games, freeware, shareware, forms, guestbooks, Java, Javascript, contests, puzzles, fonts, font resources, E-mail programs, reminder services, product samples, samples, Email services, E-mail services, advertising, graphics, free banner ads, free World Wide Web resources, counters, Trackers, Guestbooks, Access Logs, Banners, Graphics, Banner ads, Fonts, Form Mailer, form mailers, graphics, icons, games, freeware, shareware, forms, guestbooks, Java, Javascript, contests, puzzles, fonts, font resources, E-mail programs, reminder services, product samples, samples, Email services, E-mail services, advertising, graphics, free banner ads, free World Wide Web resources" name="keywords">
<meta NAME="RESOURCE-TYPE"
CONTENT="pop hypertext sources hypermedia server scripting shtml phtml html developer code base tools open source web site browser free software webmaster cgi dhtml dynamic content netscape explorer shareware download website construction free tutorial news design maintenance page hit cvs mailing list projects httpd mod_perl mod www htdig xml perl scripts script server-side-include apache database MySQL mysql msql postres postresql module linux online cpp Visual Basic JavaScript delphi wap job informer java opengl directx">
<title>Информационный сервер для программистов - исходники со всего света.</title>
</head>

<body topmargin="0" leftmargin="0" marginwidth="0" marginheigth="0" bgcolor=white>

<form action="/cgi-bin/sources/search/search.pl" method="get" align="left">
  <input type="hidden" name="stpos" value="0"><table border="0" cellpadding="0"
  cellspacing="0" width="750">
    <tr>
      <td valign="top" rowspan="2"><table border="0" cellpadding="0" cellspacing="0" width="287">
        <tr>
          <td colspan="2" bgcolor="#A5E4A7" valign="middle" align="center"><b>WWW.ИСХОДНИКИ.РУ</b></td>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">cpp.sources.ru</font></b></td>
        </tr>
        <tr>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">java.sources.ru</font></b></td>
          <td bgcolor="#C0C0C0" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>web.sources.ru</b></font></td>
          <td bgcolor="#A5E4A7" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>soft.sources.ru</b></font></td>
        </tr>
        <tr>
          <td bgcolor="#C0C0C0" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>jdbc.sources.ru</b></font></td>
          <td bgcolor="#A5E4A7" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>asp.sources.ru</b></font></td>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">api.sources.ru</font></b></td>
        </tr>
      </table>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td><font style="font-size: 8pt" size="2" face="Tahoma">&nbsp; Поиск по
          программированию :<br>
          </font>&nbsp; <input type="text" size="13" name="query"> <input type="submit"
          value="Поиск"><font size="1"><input
          TYPE="Radio" NAME="stype" VALUE="AND" checked>&quot;AND&quot; <input TYPE="Radio"
          NAME="stype" VALUE="OR">&quot;OR&quot;</font>


<!--TopList COUNTER--><a target=_top
href="http://top.list.ru/jump?from=89876"><script language="JavaScript"><!--
d=document;a='';a+=';r='+escape(d.referrer)
js=10//--></script><script language="JavaScript1.1"><!--
a+=';j='+navigator.javaEnabled()
js=11//--></script><script language="JavaScript1.2"><!--
s=screen;a+=';s='+s.width+'*'+s.height
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth)
js=12//--></script><script language="JavaScript1.3"><!--
js=13//--></script><script language="JavaScript"><!--
d.write('<img src="http://top.list.ru/counter'+
'?id=89876;t=57;js='+js+a+';rand='+Math.random()+
'" alt="TopList" '+ 'border=0 height=1 width=1>')
if(js>11)d.write('<'+'!-- ')//--></script><noscript><img
src="http://top.list.ru/counter?js=na;id=89876;t=57"
border=0 height=1 width=1
alt="TopList"></noscript><script language="JavaScript"><!--
if(js>11)d.write('--'+'>')//--></script></a><!--TopList COUNTER-->


<a href="http://counter.rambler.ru/top100/"><img src="http://counter.rambler.ru/top100.cnt?163871" alt="Rambler's Top100" width=1 height=1 border=0></a>

<!-- SpyLOG f:0211 --> 
<script language="javascript"> 
u="u1624.10.spylog.com";d=document;nv=navigator;na=nv.appName;p=1; 
bv=Math.round(parseFloat(nv.appVersion)*100); 
n=(na.substring(0,2)=="Mi")?0:1;rn=Math.random();z="p="+p+"&rn="+rn;y=""; 
y+="<a href='http://"+u+"/cnt?f=3&p="+p+"&rn="+rn+"' target=_blank>"; 
y+="<img src='http://"+u+"/cnt?"+z+ "&r="+escape(d.referrer)+"&pg="+escape(window.location.href)+"' border=0 width=1 height=1 alt='SpyLOG'>"; 
y+="</a>"; d.write(y);if(!n) { d.write("<"+"!--"); }//--></script><noscript> 
<a href="http://u1624.10.spylog.com/cnt?f=3&p=1" target=_blank> 
<img src="http://u1624.10.spylog.com/cnt?p=1" alt='SpyLOG' border='0' width=1 height=1 > 
</a></noscript><script language="javascript1.2"><!-- 
if(!n) { d.write("--"+">"); }//--></script> 
<!-- SpyLOG -->


</td>
        </tr>
      </table>
      </td>
      <td align="center"><font style="font-size: 15pt" color="#4904B1" size="4"
      face="Times New Roman">Информационный сервер</font></td>
    </tr>
    <tr>
      <td>


<!-- LBE -->
<script>
// <!--
rand = Math.round((Math.random() * (10000 - 1)));
document.write("<a href=http://www.lbe.ru/cgi-bin/href/castle?" + rand + " target=_blank><img src=http://www.lbe.ru/cgi-bin/banner/castle?" + rand + " width=468 height=60 border=0 alt=LBE ismap></a><br>");
// -->
</script>
<noscript>
                                                                                                                                                                <br>
</noscript>
<!-- LBE -->



      </td>
    </tr>
    <tr>
      <td colspan="2"><table border="0" cellpadding="0" cellspacing="1" width="100%">
        <tr>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a
          href="../www.sources.html"><font color="#000000" size="2">На главную</font></a></td>
          <td align="center" width="20%" bgcolor="#E0E0C6"><a
          href="../subscribe.html"><font color="#000000" size="2">Подписаться на новости</font></a></td>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a href="../cgi-bin/sources/Ultimate.pl"><font color="#000000" size="2">Форум</font></a></td>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a href="../books.html"><font color="#000000" size="2">Книги</font></a></td>
          <td align="center" width="7%" bgcolor="#E0E0C6"><a href="http://chat.vidcenter.ru:82/"><font color="#000000" size="2">Чат</font></a></td>
          <td align="center" width="13%" bgcolor="#E0E0C6"><a href="http://www.countries.ru/"><font color="#000000" size="2">Страны мира</font></a></td>
          <td align="center" width="29%" bgcolor="#E0E0C6"><b>8</b> пользователей на сервере.
</td>
        </tr>
      </table>
      </td>
    </tr>
  </table>
</form>

<div align="center"><center>

<table width="680" cellspacing="0" cellpadding="0">
  <tr>
    <td><hr>
    <h3><font color="#a0a099">Советы по использованию Dynamic Link
    Libraries (DLLs) в MFC </font></h3>
    <p>Автор: <a href="mailto:xicoloko@hotmail.com">xicoloko</a>. </p>
    <p>Этот документ поможет начинающим
    программистам получить некоторые знания по
    разработке приложений для Windows. Когда я создаю
    новый проект, то наиболее изменяемые куски
    программы стараюсь поместить в DLL. Это даёт мне
    возможность изменять уже откомпилированную
    программу.</p>
    <p>Чтобы сделать это грамотно, дам Вам несколько
    советов. Многи могут спросить, а почему бы просто
    не использовать технологию COM ?. Ответ очевиден,
    конечно же COM является наиболее частым выбором в
    таких ситуациях. Однако, DLL это одна из живучих
    альтернатив для решения таких задач. Я
    постараюсь объяснить использование технологии
    DLL в рамках приложения под MFC. </p>
    <p>Одна из главных проблемм использования DLL
    (особенно в MFC) кроется в отладочной и релизной
    версиях. Эти версии не совместимы. Дело в том, что
    проблемма возникает при запуске отладочной
    версии Вашего приложения с DLL релизной версии. В
    таком случае Microsoft советует давать разные имена
    DLL (для релизной и отладочной версий). Итак
    релизная версия DLL остаётся в проекте с прежним
    именем, а отладочная версия должна выглядеть
    примерно так [Project Name]D.DLL. После этого Вы можете
    скопировать оба варианта DLL-ки в системную
    директорию, и быть счастливы :).</p>
    <p>Вот несколько шагов по созданию такого
    приложения (имя проекта AAA):<ol>
      <li>Скопируйте AAA.def в AAAD.def и измените все AAA на AAAD; </li>
      <li>В Project/Settings, установите Win32 Debug </li>
      <li>В закладке Link измените Output file name на AAAD.DLL; </li>
      <li>Изначальны Вы можете наблюдать на этой
        закладке: <br>
        <b>/def:&quot;.\AAA.def&quot; /out:&quot;Debug/AAAD.DLL&quot;<br>
        </b>Измените на:<br>
        <b>/def:&quot;.\AAAD.def&quot; /out:&quot;Debug/AAAD.DLL&quot;</b><br>
      </li>
    </ol>
    <p>&nbsp;</p>
    <p>Теперь отладочная версия создаст файлы AAAD.lib и
    AAAD.DLL. Когда я создаю DLL, я создаю для него
    заголовок (include header) (думаю, что все так делают),
    который называю DLL header. Этот заголовок содержит
    объявления всех экспортируемых классов. Для
    большей эффективности я включаю &quot;linking stuff&quot; в
    него, теперь, чтобы использовать DLL вам не нужно
    добавлять lib файл в Project Settings. Мой header выглядит
    примерно так:</p>
    <p>&nbsp;</p>
    <pre>#ifndef DEF_MUDASDASDASDASDAS
#define DEF_MUDASDASDASDASDAS

#ifdef _DEBUG
#pragma comment(lib, AAAD.lib)
#else
#pragma comment(lib, AAA.lib)
#endif

<span
class="codeComment">//... сдесь начинаются объявления классов</span>

#endif <span
class="codeComment">//MUDASDASDASDASDAS</span></pre>
    <h3>Программирование с изменениями</h3>
    <p>Чтобы использовать класс, содержащийся в DLL,
    достаточно объявить в Вашем проекте следующее:</p>
    <pre>class AFX_EXT_CLASS CFoo
{
 <span class="codeComment">//...</span>
}</pre>
    <p>В приложении, использующем этот класс,
    необходимо включить хедер DLL. Проблемма: Вам всё
    время прийдётся включать переменные-члены или
    методы в экспортированный класс, а для этого
    необходимо изменять DLL header, а это значит, что
    прийдётся перекомпилировать все модули,
    использующие DLL. Для новых методов я не знаю
    способа преодоления этой проблеммы, но для новых
    переменных такой способ есть. </p>
    <p>Вместо того, чтобы объявлять члены класса
    непосредственно в теле класса, вы создаёте класс
    с указателем на включаемый класс:</p>
    <pre>class CFooImpl;
class CFoo
{
protected:
 CFooImpl* m_pThis;
};</pre>
    <p>Теперь класс CFooImpl не требует объявления, чтобы
    использовать его из DLL. Функции-члены класса CFoo
    выглядят примерно так:</p>
    <pre>class CFooImpl
{
public:
 CString m_sName;
};

CFoo::CFoo()
{
 m_pThis = new CFooImpl;

 m_pThis-&gt;m_sName = _T(&quot;Unknown&quot;);
}

CFoo::~CFoo()
{
 delete m_pThis;
}</pre>
    <p>Другой способ - это использовать специальных
    структур Windows API. Вам нужно объявить метод,
    который использует в качестве входных и выходных
    параметров LPVOID. Данные указатели - это адреса
    экземпляров структур. Этот приём определяет
    первого члена рассмотренной структуры - DWORD,
    который является размером.</p>
    <pre>&nbsp;
typedef struct tagCHANGEABLE
{
 DWORD dwSize;
 long lBytes;
}CHANGEABLE, *LPCHANGEABLE;

BOOL CFoo::Method(LPVOID lpIn)
{
 LPCHANGEABLE lpChangeable = (LPCHANGEABLE)lpIn;

 if (lpChangeable-&gt;dwSize == sizeof(CHANGEABLE))
 {
  <span
class="codeComment">//...</span>
  return TRUE;
 }

 return FALSE;
}
</pre>
    <p>Используем его:</p>
    <pre>CFoo myFoo;

CHANGEABLE changeable;
memset(&amp;changeable, 0, sizeof(changeable));

changeable.dwSize = sizeof(changeable);

myFoo.Method(&amp;changeable);</pre>
    <h3>DLL загружается при необходимости</h3>
    <p>Иногда возникает ситуация, когда Вам нужно
    вызвать диалог или инициализировать класс. Тогда
    Вы решаете поместить его в DLL, но Вы не хотите,
    чтобы он загружался во время выполнения
    приложения. Вы хотите загрузить DLL только при
    необходимости (COM). Это тип DLL я называю Dynamic DLL (масло
    маслянное “Dynamic Dynamic link libraries”). Итак, Вы
    объявляете экспортируемую функцию как:</p>
    <pre>__declspec( DLLexport )
void MyExportedFunc(DWORD dw)
{
 <span class="codeComment">//...</span>
}</pre>
    <p>Необходимо включить эту функцию в файлы&nbsp; .def
    (debug и release). Отладочный def-файл будет выглядеть
    примерно так: </p>
    <pre>; AAAD.def : Объявление параметров модуля для DLL.

LIBRARY      &quot;AAAD&quot;

DESCRIPTION  'AAAD Windows Dynamic Link Library'

EXPORTS
 MyExportedFunc @1
 ; Explicit exports can go here</pre>
    <p>Теперь, чтобы использовать эту функцию,
    необходимо загрузить библиотеку, найдите точку
    входа в функцию и вызовите её. </p>
    <pre>typedef void (*MYFUNC)(DWORD);  

#ifdef _DEBUG
 HINSTANCE hDLL = AfxLoadLibrary(&quot;AAADLLD&quot;);
#else
 HINSTANCE hDLL = AfxLoadLibrary(&quot;AAADLL&quot;);
#endif

if (hDLL)
{
 FARPROC pnProc = GetProcAddress(hDLL, &quot;MyExportedFunc&quot;);
 MYFUNC pnMyfunc = (MYFUNC)pnProc;

 pnMyfunc(0);

 FreeLibrary(hDLL);
}</pre>
    <p>Не забудьте, что для того, чтобы показать диалог,
    Вам необходимо позаботиться о необходимых
    ресурсах (AfxSetResource..). Такой подход позволяет
    создать копии класса. В определении класса
    должны использоваться только виртуальные
    функции (чтобы избежать &quot;unresolved external symbol&quot;).
    Это примерно также как в COM. </p>
    <p>Объявление класса будет выглядеть так: </p>
    <pre>class CFoo
{
public:
 virtual void Initialize (CString sName) = 0;
};</pre>
    <p>Включаем этот &quot;interface&quot; в другой класс, не
    видимый через заголовочный файл DLL. </p>
    <pre>class CFooImp  : public CFoo
{
public:
 CFooImp();
 virtual ~CFooImp();

 void Initialize (CString sName)
 {
  m_sName  = sName;
 }

protected:
 CString m_sName;
};</pre>
    <p>Чтобы создать образец класса (интерфейс) вам
    необходимо создать экспортированную функцию. </p>
    <pre>__declspec(DLLexport)

CFoo* CreateFoo(DWORD dwVersion)
{
 if (dwVersion == CURRENT_VERSION)
  return new CFooImp;

 return NULL;
}</pre>
    <p>Приложение инициализирует класс следующим
    образом: </p>
    <pre>typedef CFoo* (*MYFUNC)(DWORD);  

#ifdef _DEBUG
 HINSTANCE hDLL = AfxLoadLibrary(&quot;AAADLLD&quot;);
#else
 HINSTANCE hDLL = AfxLoadLibrary(&quot;AAADLL&quot;);
#endif

if (hDLL)
{
 FARPROC pnProc = GetProcAddress(hDLL, &quot; CreateFoo&quot;);
 MYFUNC pnMyfunc = (MYFUNC)pnProc;

 CFoo* pFoo = pnMyfunc(0);

 pFoo-&gt;Initialize(_T(&quot;Hi&quot;));

 delete pFoo;

 FreeLibrary(hDLL);
}</pre>
    <p>Не забудьте, что Вы не можете освободить
    библиотеку до тех пор пока Вы не удалите объект
    класса CFoo.</p>
    <p>&nbsp;</td>
  </tr>
</table>
</center></div>


<hr>
<div align="center"><center>

<table border="0" cellpadding="0" cellspacing="3" width="468">
  <tr>
    <td width="154"><!-- LBE_LITE --> <script>
// <!--
rand = Math.round((Math.random() * (10000 - 1)));
document.write("<a href=http://lite.lbe.ru/cgi-bin/href/castle?" + rand + " target=_blank><img src=http://lite.lbe.ru/cgi-bin/banner/castle?" + rand + " width=468 height=60 border=0 alt=LBE_LITE ismap></a><br>");
// -->
</script> <noscript> <br>
</noscript><!-- LBE_LITE --></td>
  </tr>
</table>
</center></div>
</body>
</html>
