<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
<style type="text/css">
A.black:link {COLOR: #000000; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
A.black:visited {COLOR: #000000; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
A.black:hover {COLOR: #FFFFFF; TEXT-DECORATION: none;FONT-FAMILY: Arial,Verdana,Tahoma,sans-serif; FONT-SIZE: 9pt}
.b {text-decoration: none; color:#FF0000;} 
.b:hover {color:#7785FF;}
.c {text-decoration: none; color:#000000;} 
.c:hover {color:#FFFFFF;}
 pre {color: blue;}
TD.colon {COLOR: #000000; FONT-FAMILY: "MS Sans Serif", sans-serif; FONT-SIZE: 9pt}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta content="программирование на Visual Basic, документация, документы, delphi, pascal, cpp, hardware, web, веб-мастер, советы, описания, доки, manual, Java, C, C++, обучение, исходники, odbc, jdbc, programm, protocols, протоколы, общение, форумapplet, java, design, апплет, дизайн, ява, Free, counters, Trackers, Guestbooks, Access Logs, Banners, Graphics, Banner ads, Fonts, Form Mailer, form mailers, graphics, icons, games, freeware, shareware, forms, guestbooks, Java, Javascript, contests, puzzles, fonts, font resources, E-mail programs, reminder services, product samples, samples, Email services, E-mail services, advertising, graphics, free banner ads, free World Wide Web resources, counters, Trackers, Guestbooks, Access Logs, Banners, Graphics, Banner ads, Fonts, Form Mailer, form mailers, graphics, icons, games, freeware, shareware, forms, guestbooks, Java, Javascript, contests, puzzles, fonts, font resources, E-mail programs, reminder services, product samples, samples, Email services, E-mail services, advertising, graphics, free banner ads, free World Wide Web resources" name="keywords">
<meta NAME="RESOURCE-TYPE"
CONTENT="pop hypertext sources hypermedia server scripting shtml phtml html developer code base tools open source web site browser free software webmaster cgi dhtml dynamic content netscape explorer shareware download website construction free tutorial news design maintenance page hit cvs mailing list projects httpd mod_perl mod www htdig xml perl scripts script server-side-include apache database MySQL mysql msql postres postresql module linux online cpp Visual Basic JavaScript delphi wap job informer java opengl directx">
<title>Информационный сервер для программистов - исходники со всего света.</title>
</head>

<body topmargin="0" leftmargin="0" marginwidth="0" marginheigth="0" bgcolor=white>

<form action="/cgi-bin/sources/search/search.pl" method="get" align="left">
  <input type="hidden" name="stpos" value="0"><table border="0" cellpadding="0"
  cellspacing="0" width="750">
    <tr>
      <td valign="top" rowspan="2"><table border="0" cellpadding="0" cellspacing="0" width="287">
        <tr>
          <td colspan="2" bgcolor="#A5E4A7" valign="middle" align="center"><b>WWW.ИСХОДНИКИ.РУ</b></td>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">cpp.sources.ru</font></b></td>
        </tr>
        <tr>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">java.sources.ru</font></b></td>
          <td bgcolor="#C0C0C0" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>web.sources.ru</b></font></td>
          <td bgcolor="#A5E4A7" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>soft.sources.ru</b></font></td>
        </tr>
        <tr>
          <td bgcolor="#C0C0C0" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>jdbc.sources.ru</b></font></td>
          <td bgcolor="#A5E4A7" valign="middle" align="center"><font face="Tahoma"
          style="font-size: 8pt" size="-1"><b>asp.sources.ru</b></font></td>
          <td bgcolor="#000080" valign="middle" align="center"><b><font face="Tahoma"
          style="font-size: 8pt" size="-1" color="#FFFFFF">api.sources.ru</font></b></td>
        </tr>
      </table>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td><font style="font-size: 8pt" size="2" face="Tahoma">&nbsp; Поиск по
          программированию :<br>
          </font>&nbsp; <input type="text" size="13" name="query"> <input type="submit"
          value="Поиск"><font size="1"><input
          TYPE="Radio" NAME="stype" VALUE="AND" checked>&quot;AND&quot; <input TYPE="Radio"
          NAME="stype" VALUE="OR">&quot;OR&quot;</font>


<!--TopList COUNTER--><a target=_top
href="http://top.list.ru/jump?from=89876"><script language="JavaScript"><!--
d=document;a='';a+=';r='+escape(d.referrer)
js=10//--></script><script language="JavaScript1.1"><!--
a+=';j='+navigator.javaEnabled()
js=11//--></script><script language="JavaScript1.2"><!--
s=screen;a+=';s='+s.width+'*'+s.height
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth)
js=12//--></script><script language="JavaScript1.3"><!--
js=13//--></script><script language="JavaScript"><!--
d.write('<img src="http://top.list.ru/counter'+
'?id=89876;t=57;js='+js+a+';rand='+Math.random()+
'" alt="TopList" '+ 'border=0 height=1 width=1>')
if(js>11)d.write('<'+'!-- ')//--></script><noscript><img
src="http://top.list.ru/counter?js=na;id=89876;t=57"
border=0 height=1 width=1
alt="TopList"></noscript><script language="JavaScript"><!--
if(js>11)d.write('--'+'>')//--></script></a><!--TopList COUNTER-->


<a href="http://counter.rambler.ru/top100/"><img src="http://counter.rambler.ru/top100.cnt?163871" alt="Rambler's Top100" width=1 height=1 border=0></a>

<!-- SpyLOG f:0211 --> 
<script language="javascript"> 
u="u1624.10.spylog.com";d=document;nv=navigator;na=nv.appName;p=1; 
bv=Math.round(parseFloat(nv.appVersion)*100); 
n=(na.substring(0,2)=="Mi")?0:1;rn=Math.random();z="p="+p+"&rn="+rn;y=""; 
y+="<a href='http://"+u+"/cnt?f=3&p="+p+"&rn="+rn+"' target=_blank>"; 
y+="<img src='http://"+u+"/cnt?"+z+ "&r="+escape(d.referrer)+"&pg="+escape(window.location.href)+"' border=0 width=1 height=1 alt='SpyLOG'>"; 
y+="</a>"; d.write(y);if(!n) { d.write("<"+"!--"); }//--></script><noscript> 
<a href="http://u1624.10.spylog.com/cnt?f=3&p=1" target=_blank> 
<img src="http://u1624.10.spylog.com/cnt?p=1" alt='SpyLOG' border='0' width=1 height=1 > 
</a></noscript><script language="javascript1.2"><!-- 
if(!n) { d.write("--"+">"); }//--></script> 
<!-- SpyLOG -->


</td>
        </tr>
      </table>
      </td>
      <td align="center"><font style="font-size: 15pt" color="#4904B1" size="4"
      face="Times New Roman">Информационный сервер</font></td>
    </tr>
    <tr>
      <td>


<!-- LBE -->
<script>
// <!--
rand = Math.round((Math.random() * (10000 - 1)));
document.write("<a href=http://www.lbe.ru/cgi-bin/href/castle?" + rand + " target=_blank><img src=http://www.lbe.ru/cgi-bin/banner/castle?" + rand + " width=468 height=60 border=0 alt=LBE ismap></a><br>");
// -->
</script>
<noscript>
                                                                                                                                                                <br>
</noscript>
<!-- LBE -->



      </td>
    </tr>
    <tr>
      <td colspan="2"><table border="0" cellpadding="0" cellspacing="1" width="100%">
        <tr>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a
          href="../www.sources.html"><font color="#000000" size="2">На главную</font></a></td>
          <td align="center" width="20%" bgcolor="#E0E0C6"><a
          href="../subscribe.html"><font color="#000000" size="2">Подписаться на новости</font></a></td>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a href="../cgi-bin/sources/Ultimate.pl"><font color="#000000" size="2">Форум</font></a></td>
          <td align="center" width="11%" bgcolor="#E0E0C6"><a href="../books.html"><font color="#000000" size="2">Книги</font></a></td>
          <td align="center" width="7%" bgcolor="#E0E0C6"><a href="http://chat.vidcenter.ru:82/"><font color="#000000" size="2">Чат</font></a></td>
          <td align="center" width="13%" bgcolor="#E0E0C6"><a href="http://www.countries.ru/"><font color="#000000" size="2">Страны мира</font></a></td>
          <td align="center" width="29%" bgcolor="#E0E0C6"><b>3</b> пользователей на сервере.
</td>
        </tr>
      </table>
      </td>
    </tr>
  </table>
</form>

<div align="center"><center>

<table width="680" cellspacing="0" cellpadding="0">
  <tr>
    <td><img src="../t1.gif" width="15" height="1"></td>
    <td><hr>
    <p><b>Пример программирования протокола IPX в среде
    MS Visual C++.</b></p>
    <p>Полный проект можно взять <a href="socket.zip">сдесь</a><br>
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td width="750" bgcolor="#A5E4A7"><font style="font-size: 10pt" size="2" face="Tahoma"><b>&nbsp;
        Листинг 1 (Mainw.cpp)</b></font></td>
      </tr>
    </table>
    <p>#include &quot;class.h&quot;<br>
    <br>
    <br>
    /*<br>
    char buf[10];<br>
    sprintf(buf,&quot;%d&quot;,);<br>
    MessageBox(buf,&quot;Проверка&quot;,MB_OK );<br>
    */<br>
    <br>
    ///////////////////////////////////////////////////////////////<br>
    //Функция создания окна<br>
    ///////////////////////////////////////////////////////////////<br>
    <br>
    CMainWnd::CMainWnd(LPCSTR Class)<br>
    { <br>
    <br>
    Create(Class,&quot;Socket&quot;,WS_OVERLAPPEDWINDOW|
    WS_SYSMENU|WS_MINIMIZEBOX|WS_MAXIMIZEBOX,rectDefault,NULL,&quot;TIMERMENU&quot;);<br>
    //WS_SYSMENU|WS_MAXIMIZEBOX|WS_MINIMIZEBOX,size,NULL,&quot;TIMERMENU&quot;);<br>
    <br>
    }<br>
    <br>
    <br>
    BOOL CApp::InitInstance()<br>
    {<br>
    CBrush r;<br>
    <br>
    r.CreateStockObject(WHITE_BRUSH);<br>
    LPCSTR cname=AfxRegisterWndClass(0,NULL,r,LoadIcon(&quot;MAIN&quot;));<br>
    <br>
    m_pMainWnd=new CMainWnd(cname);<br>
    m_pMainWnd-&gt;ShowWindow(m_nCmdShow);<br>
    m_pMainWnd-&gt;UpdateWindow();<br>
    <br>
    <br>
    return TRUE;<br>
    }<br>
    <br>
    <br>
    /////////////////////////////////////////////////////////////////////////////////////////////<br>
    //Обработка сообщения от Главного окна<br>
    /////////////////////////////////////////////////////////////////////////////////////////////<br>
    <br>
    <br>
    afx_msg void CMainWnd::OnPaint()<br>
    {<br>
    <br>
    CPaintDC DC(this);<br>
    <br>
    }<br>
    <br>
    afx_msg void CMainWnd::OnButton()<br>
    {<br>
    <br>
    //Заполняем буфер который передаем<br>
    RcBuffer[1] = 0x50;<br>
    RcBuffer[2] = 0xC0;<br>
    RcBuffer[3] = 0x10;<br>
    RcBuffer[4] = 0xC0;<br>
    //Передача<br>
    SendDGRM(sock,IPX_RECV,BROADCAST_NODE,RcBuffer,5);<br>
    <br>
    if(snd==SOCKET_ERROR){MessageBox(&quot;Ошибка&quot;,&quot;Проверка&quot;,MB_OK
    );}<br>
    }<br>
    <br>
    <br>
    afx_msg void CMainWnd::OnClose()<br>
    {<br>
    <br>
    PostQuitMessage(0);<br>
    } <br>
    <br>
    afx_msg int CMainWnd::OnCreate(LPCREATESTRUCT lpCreateStruct)<br>
    {<br>
    <br>
    &nbsp;&nbsp;&nbsp;
    bsend.Create(&quot;Передать&quot;,BS_TEXT|WS_TABSTOP,CRect(30,10,200,50),this,ID_BUTTON);<br>
    bsend.ShowWindow(SW_SHOW);<br>
    <br>
    &nbsp;&nbsp;&nbsp; wVersionRequested = MAKEWORD( 1, 1 );<br>
    err = WSAStartup(wVersionRequested, &amp;wsaData );<br>
    if ( err != 0 )<br>
    &nbsp;&nbsp;&nbsp; {<br>
    printf(&quot;No winsock.dll\n&quot;);<br>
    MessageBox(&quot;No winsock.dll&quot;,&quot;lejnsdlj&quot;,MB_OK);<br>
    &nbsp;&nbsp;&nbsp; }<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Создаем сокет1 для
    пердачи<br>
    &nbsp;&nbsp;&nbsp; if((sock=CreateDGRMSocket(IPX_SEND))==0)<br>
    &nbsp;&nbsp;&nbsp; {<br>
    MessageBox(&quot;Ошибка инициализации сокета
    датаграмм&quot;,&quot;Ошибка драйвера&quot;,MB_ICONSTOP);<br>
    //return FALSE;<br>
    &nbsp;&nbsp;&nbsp; }<br>
    &nbsp;&nbsp;&nbsp; //Создаем сокет2 для приема<br>
    &nbsp;&nbsp;&nbsp; if((sock1=CreateDGRMSocket(IPX_RECV))==0)<br>
    &nbsp;&nbsp;&nbsp; {<br>
    MessageBox(&quot;Ошибка инициализации сокета
    датаграмм&quot;,&quot;Ошибка драйвера&quot;,MB_ICONSTOP);<br>
    //return FALSE;<br>
    &nbsp;&nbsp;&nbsp; }<br>
    &nbsp;&nbsp;&nbsp; //Создаем сообщение которое возникает
    при принятии сообщения<br>
    &nbsp;&nbsp;&nbsp; if(!AsyncSel(sock1,&quot;Ошибка установки события
    FD_READ и сообщения MW_READ&quot;,wMsg1,FD_READ))<br>
    return 0;<br>
    return 0;<br>
    <br>
    <br>
    }<br>
    <br>
    <br>
    /////////////////////////////////////////////////////////////////////////////////////////////<br>
    //Обработка сообщения от меню<br>
    /////////////////////////////////////////////////////////////////////////////////////////////<br>
    &nbsp;&nbsp;&nbsp; <br>
    afx_msg void CMainWnd::OnExit()<br>
    {<br>
    SendMessage(WM_CLOSE);<br>
    closesocket(sock);<br>
    }<br>
    <br>
    afx_msg void CMainWnd::OnAbout()<br>
    {<br>
    //CenterWindow(this);<br>
    AboutDialog about(&quot;ABOUT&quot;,this);<br>
    about.DoModal();<br>
    }<br>
    <br>
    <br>
    afx_msg LRESULT CMainWnd::OnRecv(WPARAM wParam,LPARAM lParam)<br>
    {<br>
    int Len=0;<br>
    <br>
    sRecAddr = sizeof(struct sockaddr);<br>
    memset(RcBuffer,0,sizeof(RcBuffer));<br>
    //Прием данных<br>
    Len = recvfrom(sock1,(char*)RcBuffer,sizeof(RcBuffer),0,&amp;RecAddr,&amp;sRecAddr);<br>
    //Запоминаем адрес в более удобном виде<br>
    memcpy(&amp;Ipx_Addr,&amp;RecAddr,sizeof(SOCKADDR_IPX));<br>
    <br>
    MessageBox(&quot;Получил&quot;,&quot;Проверка&quot;,MB_OK );<br>
    return 0;<br>
    }<br>
    <br>
    /////////////////////////////////////////////////////////////////////////////////////////////<br>
    /////////////////////////////////////////////////////////////////////////////////////////////<br>
    /////////////////////////////////////////////////////////////////////////////////////////////<br>
    <br>
    <br>
    <br>
    SOCKET CMainWnd::CreateDGRMSocket(BYTE* IdSock)<br>
    {<br>
    SOCKET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sock;<br>
    SOCKADDR_IPX addr;<br>
    PSOCKADDR_IPX pSockAddr;<br>
    <br>
    //Получаем сокет<br>
    //IPX семейство,послед.передача,протокол SPX<br>
    sock = socket(AF_IPX,SOCK_DGRAM,NSPROTO_IPX);<br>
    if(sock==INVALID_SOCKET)<br>
    &nbsp;&nbsp;&nbsp; {<br>
    &nbsp;&nbsp;&nbsp; MessageBox(&quot;Ошибка получения
    сокета&quot;,&quot;Ошибка&quot;,MB_OK|MB_ICONSTOP);<br>
    &nbsp;&nbsp;&nbsp; return 0;<br>
    &nbsp;&nbsp;&nbsp; }//if(sock==INVALID_SOCKET)<br>
    <br>
    //Сокет является широковещательным<br>
    Enable_Broadcasts(sock,TRUE);<br>
    <br>
    //Готовим связку сокета с номером и сетевым
    адресом<br>
    memset(&amp;addr, 0, sizeof(addr)); // Очищаем память<br>
    pSockAddr = (PSOCKADDR_IPX)&amp;addr; // Set pointer<br>
    pSockAddr-&gt;sa_family = AF_IPX;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // IPX Family<br>
    // Записываем номер передающего сокета<br>
    memcpy(&amp;pSockAddr-&gt;sa_socket,IdSock, 2);<br>
    <br>
    //Получаем связанный сокет с локальным адресом<br>
    if(bind(sock,(PSOCKADDR)pSockAddr,sizeof(SOCKADDR_IPX)) == SOCKET_ERROR) <br>
    {<br>
    MessageBox(&quot;Не могу связать сокет с локальным
    адресом&quot;,<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &quot;Ошибка сокета&quot;,MB_OK|MB_ICONSTOP);<br>
    <br>
    }//if (bind(sock,(PSOCKADDR)pSockAddr,sizeof(SOCKADDR_IPX)) == SOCKET_ERROR) <br>
    <br>
    //Делаем сокет широковещательным<br>
    //Это необходимо сделать иначе мы не услышим что
    делается в сети<br>
    Enable_Broadcasts(sock,TRUE);<br>
    <br>
    return sock;<br>
    }//SOCKET CreateDGRMSocket(HWND,BYTE*);<br>
    <br>
    BOOL CMainWnd::AsyncSel(SOCKET s,char *Text,UINT msg,long Event)<br>
    {<br>
    //Указываем окно в которое будут поступать
    сообщения которые тоже указываем<br>
    if(WSAAsyncSelect(s,m_hWnd,msg,Event))<br>
    {<br>
    &nbsp;&nbsp;&nbsp; MessageBox(Text,&quot;Ошибка&quot;,MB_OK|MB_ICONSTOP);<br>
    &nbsp;&nbsp;&nbsp; closesocket(s);<br>
    &nbsp;&nbsp;&nbsp; return 0;<br>
    }<br>
    return TRUE;<br>
    }//BOOL AsyncSel(HWND hwnd,HWND hwndParent,SOCKET s,char *Text,UINT msg,long Event)<br>
    <br>
    <br>
    int CMainWnd::Enable_Broadcasts(SOCKET s,BOOL EnableBrCst)<br>
    {<br>
    int rc;<br>
    BOOL optval = EnableBrCst;<br>
    <br>
    &nbsp;&nbsp;&nbsp; rc = setsockopt(s, SOL_SOCKET, SO_BROADCAST, (const char
    FAR*)&amp;optval, sizeof(BOOL));<br>
    <br>
    if (rc == SOCKET_ERROR) {<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox(&quot;Не могу сделать
    широковещательный сокет&quot;,<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &quot;Ошибка сокета&quot;,MB_OK|MB_ICONSTOP);<br>
    closesocket(s);<br>
    return 1;<br>
    }<br>
    return 0;<br>
    }<br>
    <br>
    <br>
    BOOL CMainWnd::SendDGRM(SOCKET sock,BYTE *toSock,BYTE *toNodeAdrr,<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BYTE *Message,int Len2)<br>
    {<br>
    SOCKADDR_IPX addr;<br>
    int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Len1;
    &nbsp;&nbsp;&nbsp; <br>
    <br>
    //Канал занят<br>
    //if(DGRMSocketBusy) return FALSE;<br>
    <br>
    //DGRMSocketBusy = TRUE;<br>
    //Готовим адрес<br>
    memset(&amp;addr, 0, sizeof(addr)); // Очищаем память<br>
    addr.sa_family = AF_IPX; // IPX Family<br>
    // Записываем номер принимающего сокета<br>
    memcpy(&amp;addr.sa_socket,toSock,2);<br>
    // Записываем номер принимающего узла<br>
    memcpy(&amp;addr.sa_nodenum,toNodeAdrr,6);<br>
    <br>
    //Отправляем пакет по узлу<br>
    if((Len1=sendto(sock,(const char*)Message,Len2,0,(const struct sockaddr
    *)&amp;addr,16))!=Len2)<br>
    {<br>
    &nbsp;&nbsp;&nbsp; Len2 = WSAGetLastError();<br>
    &nbsp;&nbsp;&nbsp; if(SOCKET_ERROR==Len1)<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox(&quot;Не могу
    отправить пакет узлу сети&quot;,<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &quot;Сетевая ошибка&quot;,MB_OK|MB_ICONSTOP);<br>
    else<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox(&quot;Пакет не
    принят&quot;,<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &quot;Сетевая ошибка&quot;,MB_OK|MB_ICONSTOP);<br>
    return 0;<br>
    }//if()<br>
    return TRUE;<br>
    }//BOOL SendDGRM(HWND hwnd,SOCKET sock,BYTE *toSock,BYTE *toNodeAdrr,<br>
    //&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BYTE *Message,int
    Len2)<br>
    <br>
    <br>
    </p>
    <table border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td width="750" bgcolor="#A5E4A7"><font style="font-size: 10pt" size="2" face="Tahoma"><b>&nbsp;
        Листинг 2 (Class.h)</b></font></td>
      </tr>
    </table>
    <p>#include &lt;afxwin.h&gt;<br>
    #include &lt;winsock.h&gt;<br>
    #include &lt;wsipx.h&gt;<br>
    <br>
    char buf[80];//общий буфер<br>
    <br>
    //Элементы меню<br>
    #define ID_EXIT 102//Выход<br>
    #define ID_HELP1 103//Помощь<br>
    #define ID_ABOUT 104//О программе<br>
    <br>
    int wMsg1=WM_USER+1;<br>
    <br>
    <br>
    #define ID_BUTTON 1000// кнопка в нлавном окне Передать<br>
    <br>
    #define SIZE_BUFFER_IO 2<br>
    <br>
    <br>
    int snd, err;<br>
    WORD wVersionRequested;<br>
    WSADATA wsaData;<br>
    SOCKET sock,sock1;<br>
    BYTE BROADCAST_NODE[6] = {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF};//Broadcast сокет<br>
    BYTE IPX_SEND[2] = {0xcf,0xfc};//Сокет <br>
    BYTE IPX_RECV[2] = {0x2f,0xfc};//Сокет <br>
    BYTE RcBuffer[SIZE_BUFFER_IO*800];//~204kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    //Буффер приема<br>
    <br>
    static struct sockaddr RecAddr;<br>
    static int&nbsp;&nbsp;&nbsp; sRecAddr;<br>
    <br>
    <br>
    //класс главного окна<br>
    class CMainWnd:public CFrameWnd<br>
    {<br>
    <br>
    <br>
    public:<br>
    <br>
    SOCKET CreateDGRMSocket(BYTE* );<br>
    int Enable_Broadcasts(SOCKET ,BOOL );<br>
    BOOL SendDGRM(SOCKET,BYTE *,BYTE *,BYTE *,int );<br>
    BOOL AsyncSel(SOCKET,char *,UINT ,long );<br>
    SOCKADDR_IPX Ipx_Addr;<br>
    CButton bsend;<br>
    <br>
    CMainWnd(LPCSTR Class);<br>
    afx_msg void OnDestroy();<br>
    afx_msg void OnPaint();<br>
    afx_msg void OnClose();<br>
    afx_msg void OnExit();<br>
    afx_msg int OnCreate(LPCREATESTRUCT lpCreateStruct);<br>
    afx_msg void OnButton();<br>
    afx_msg LRESULT OnRecv(WPARAM wParam,LPARAM lParam);<br>
    afx_msg void OnAbout();<br>
    <br>
    DECLARE_MESSAGE_MAP()<br>
    <br>
    };<br>
    <br>
    //класс всего приложения<br>
    class CApp:public CWinApp<br>
    {<br>
    public:<br>
    BOOL InitInstance();<br>
    };<br>
    <br>
    //класс диалога About<br>
    class AboutDialog:public CDialog<br>
    {<br>
    <br>
    public:<br>
    AboutDialog(char *DialogName, CWnd *Ower):<br>
    CDialog(DialogName,Ower){}<br>
    DECLARE_MESSAGE_MAP()<br>
    };<br>
    <br>
    <br>
    //Очередь сообщения Диалога About<br>
    BEGIN_MESSAGE_MAP(AboutDialog,CDialog)<br>
    END_MESSAGE_MAP()<br>
    <br>
    <br>
    //Очередь сообщения главного окна<br>
    BEGIN_MESSAGE_MAP(CMainWnd,CFrameWnd)<br>
    ON_WM_PAINT()<br>
    ON_WM_CREATE()<br>
    ON_COMMAND(ID_EXIT,OnExit)<br>
    ON_COMMAND(ID_ABOUT,OnAbout)<br>
    ON_COMMAND(ID_BUTTON,OnButton)<br>
    ON_MESSAGE(wMsg1,OnRecv)<br>
    ON_COMMAND(ID_EXIT,OnExit)<br>
    END_MESSAGE_MAP()<br>
    <br>
    CApp CApp;<br>
    <br>
    <br>
    </td>
  </tr>
</table>
</center></div>


<hr>
<div align="center"><center>

<table border="0" cellpadding="0" cellspacing="3" width="468">
  <tr>
    <td width="154"><!-- LBE_LITE --> <script>
// <!--
rand = Math.round((Math.random() * (10000 - 1)));
document.write("<a href=http://lite.lbe.ru/cgi-bin/href/castle?" + rand + " target=_blank><img src=http://lite.lbe.ru/cgi-bin/banner/castle?" + rand + " width=468 height=60 border=0 alt=LBE_LITE ismap></a><br>");
// -->
</script> <noscript> <br>
</noscript><!-- LBE_LITE --></td>
  </tr>
</table>
</center></div>
</body>
</html>
